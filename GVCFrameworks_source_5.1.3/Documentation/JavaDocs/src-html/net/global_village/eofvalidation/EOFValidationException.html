<HTML>
<BODY BGCOLOR="white">
<PRE>
<FONT color="green">001</FONT>    package net.global_village.eofvalidation;<a name="line.1"></a>
<FONT color="green">002</FONT>    <a name="line.2"></a>
<FONT color="green">003</FONT>    import java.util.*;<a name="line.3"></a>
<FONT color="green">004</FONT>    <a name="line.4"></a>
<FONT color="green">005</FONT>    import com.webobjects.eoaccess.*;<a name="line.5"></a>
<FONT color="green">006</FONT>    import com.webobjects.eocontrol.*;<a name="line.6"></a>
<FONT color="green">007</FONT>    import com.webobjects.foundation.*;<a name="line.7"></a>
<FONT color="green">008</FONT>    <a name="line.8"></a>
<FONT color="green">009</FONT>    import net.global_village.foundation.*;<a name="line.9"></a>
<FONT color="green">010</FONT>    <a name="line.10"></a>
<FONT color="green">011</FONT>    <a name="line.11"></a>
<FONT color="green">012</FONT>    /**<a name="line.12"></a>
<FONT color="green">013</FONT>     * &lt;p&gt;An exception that contains a message key path, which can be used to retrieve a localized text message for display to<a name="line.13"></a>
<FONT color="green">014</FONT>     * the user.&lt;/p&gt;<a name="line.14"></a>
<FONT color="green">015</FONT>     *<a name="line.15"></a>
<FONT color="green">016</FONT>     * &lt;p&gt;&lt;b&gt;Example validateForSave Usage:&lt;/b&gt;&lt;/p&gt;<a name="line.16"></a>
<FONT color="green">017</FONT>     *<a name="line.17"></a>
<FONT color="green">018</FONT>     * &lt;pre&gt;<a name="line.18"></a>
<FONT color="green">019</FONT>     * public void validateForSave() throws ValidationException<a name="line.19"></a>
<FONT color="green">020</FONT>     * {<a name="line.20"></a>
<FONT color="green">021</FONT>     *    NSMutableArray exceptions = new NSMutableArray();<a name="line.21"></a>
<FONT color="green">022</FONT>     *<a name="line.22"></a>
<FONT color="green">023</FONT>     *    try<a name="line.23"></a>
<FONT color="green">024</FONT>     *    {<a name="line.24"></a>
<FONT color="green">025</FONT>     *        super.validateForSave();<a name="line.25"></a>
<FONT color="green">026</FONT>     *    }<a name="line.26"></a>
<FONT color="green">027</FONT>     *    catch (NSValidation.ValidationException e)<a name="line.27"></a>
<FONT color="green">028</FONT>     *    {<a name="line.28"></a>
<FONT color="green">029</FONT>     *        exceptions.addObject(e);<a name="line.29"></a>
<FONT color="green">030</FONT>     *    }<a name="line.30"></a>
<FONT color="green">031</FONT>     *<a name="line.31"></a>
<FONT color="green">032</FONT>     *    if (numPages().intValue() &amp;gt; ( marriage().pagesPerSheet().intValue() * numSheets().intValue()) )<a name="line.32"></a>
<FONT color="green">033</FONT>     *    {<a name="line.33"></a>
<FONT color="green">034</FONT>     *        exceptions.addObject(new EOFValidationException(this, &amp;quot;numPagesNumSheetsMismatch&amp;quot;);<a name="line.34"></a>
<FONT color="green">035</FONT>     *    }<a name="line.35"></a>
<FONT color="green">036</FONT>     *<a name="line.36"></a>
<FONT color="green">037</FONT>     *    if (exceptions.count() &amp;gt; 0)<a name="line.37"></a>
<FONT color="green">038</FONT>     *    {<a name="line.38"></a>
<FONT color="green">039</FONT>     *        throw NSValidation.ValidationException.aggregateExceptionWithExceptions(exceptions);<a name="line.39"></a>
<FONT color="green">040</FONT>     *    }<a name="line.40"></a>
<FONT color="green">041</FONT>     * }<a name="line.41"></a>
<FONT color="green">042</FONT>     * &lt;/pre&gt;<a name="line.42"></a>
<FONT color="green">043</FONT>     *<a name="line.43"></a>
<FONT color="green">044</FONT>     *<a name="line.44"></a>
<FONT color="green">045</FONT>     * &lt;p&gt;&lt;b&gt;Example validateProperty Usage:&lt;/b&gt;&lt;/p&gt;<a name="line.45"></a>
<FONT color="green">046</FONT>     *<a name="line.46"></a>
<FONT color="green">047</FONT>     * &lt;pre&gt;<a name="line.47"></a>
<FONT color="green">048</FONT>     * public Object validateNumPages(Object value)<a name="line.48"></a>
<FONT color="green">049</FONT>     * {<a name="line.49"></a>
<FONT color="green">050</FONT>     *     if ( numPages().intValue() &lt; 2 || numPages().intValue() % 2 != 0 )<a name="line.50"></a>
<FONT color="green">051</FONT>     *     {<a name="line.51"></a>
<FONT color="green">052</FONT>     *         throw new EOFValidationException(this, NUMPAGES, EOFValidation.InvalidValue, value);<a name="line.52"></a>
<FONT color="green">053</FONT>     *         // OR throw EOFValidationException.invalidValue(this, NUMPAGES, value);<a name="line.53"></a>
<FONT color="green">054</FONT>     *     }<a name="line.54"></a>
<FONT color="green">055</FONT>     *     return value;<a name="line.55"></a>
<FONT color="green">056</FONT>     * }<a name="line.56"></a>
<FONT color="green">057</FONT>     *&lt;/pre&gt;<a name="line.57"></a>
<FONT color="green">058</FONT>     *<a name="line.58"></a>
<FONT color="green">059</FONT>     * @author Copyright (c) 2001-2005 Global Village Consulting, Inc. All rights reserved. This software is published under<a name="line.59"></a>
<FONT color="green">060</FONT>     *         the terms of the Educational Community License (ECL) version 1.0, a copy of which has been included with this<a name="line.60"></a>
<FONT color="green">061</FONT>     *         distribution in the LICENSE.TXT file.<a name="line.61"></a>
<FONT color="green">062</FONT>     * @version $Revision: 21$<a name="line.62"></a>
<FONT color="green">063</FONT>     */<a name="line.63"></a>
<FONT color="green">064</FONT>    public class EOFValidationException extends com.webobjects.foundation.NSValidation.ValidationException<a name="line.64"></a>
<FONT color="green">065</FONT>    {<a name="line.65"></a>
<FONT color="green">066</FONT>        protected Object failedValue;<a name="line.66"></a>
<FONT color="green">067</FONT>        private Exception originalException;<a name="line.67"></a>
<FONT color="green">068</FONT>    <a name="line.68"></a>
<FONT color="green">069</FONT>    <a name="line.69"></a>
<FONT color="green">070</FONT>        /**<a name="line.70"></a>
<FONT color="green">071</FONT>         * Checks that a message key path is valid.<a name="line.71"></a>
<FONT color="green">072</FONT>         *<a name="line.72"></a>
<FONT color="green">073</FONT>         * @see StringAdditions#isValidPropertyKeyPath(String)<a name="line.73"></a>
<FONT color="green">074</FONT>         * @param messageKeyPath the message key path to check<a name="line.74"></a>
<FONT color="green">075</FONT>         * @return &lt;code&gt;true&lt;/code&gt; if messageKeyPath is a valid property keypath<a name="line.75"></a>
<FONT color="green">076</FONT>         */<a name="line.76"></a>
<FONT color="green">077</FONT>        public static boolean isValidMessageKeyPath(String messageKeyPath)<a name="line.77"></a>
<FONT color="green">078</FONT>        {<a name="line.78"></a>
<FONT color="green">079</FONT>            /** require [valid_param] messageKeyPath != null; **/<a name="line.79"></a>
<FONT color="green">080</FONT>            return StringAdditions.isValidPropertyKeyPath(messageKeyPath);<a name="line.80"></a>
<FONT color="green">081</FONT>        }<a name="line.81"></a>
<FONT color="green">082</FONT>    <a name="line.82"></a>
<FONT color="green">083</FONT>    <a name="line.83"></a>
<FONT color="green">084</FONT>    <a name="line.84"></a>
<FONT color="green">085</FONT>        /**<a name="line.85"></a>
<FONT color="green">086</FONT>         * Helper method for &lt;code&gt;propertyKey()&lt;/code&gt; and &lt;code&gt;hasPropertyKey()&lt;/code&gt;.<a name="line.86"></a>
<FONT color="green">087</FONT>         *<a name="line.87"></a>
<FONT color="green">088</FONT>         * @param messageKeyPath the failure message key to use<a name="line.88"></a>
<FONT color="green">089</FONT>         * @return the property key if one exists, &lt;code&gt;null&lt;/code&gt; otherwise<a name="line.89"></a>
<FONT color="green">090</FONT>         */<a name="line.90"></a>
<FONT color="green">091</FONT>        protected static String findPropertyKey(String messageKeyPath)<a name="line.91"></a>
<FONT color="green">092</FONT>        {<a name="line.92"></a>
<FONT color="green">093</FONT>            /** require<a name="line.93"></a>
<FONT color="green">094</FONT>            [valid_param] messageKeyPath != null;<a name="line.94"></a>
<FONT color="green">095</FONT>            [is_message_key_path] isValidMessageKeyPath(messageKeyPath); **/<a name="line.95"></a>
<FONT color="green">096</FONT>    <a name="line.96"></a>
<FONT color="green">097</FONT>            String middlePart = null;<a name="line.97"></a>
<FONT color="green">098</FONT>            String firstPart = StringAdditions.objectKeyPathFromKeyPath(messageKeyPath);<a name="line.98"></a>
<FONT color="green">099</FONT>            if (StringAdditions.isValidPropertyKeyPath(firstPart))<a name="line.99"></a>
<FONT color="green">100</FONT>            {<a name="line.100"></a>
<FONT color="green">101</FONT>                middlePart = StringAdditions.propertyNameFromKeyPath(firstPart);<a name="line.101"></a>
<FONT color="green">102</FONT>            }<a name="line.102"></a>
<FONT color="green">103</FONT>            return middlePart;<a name="line.103"></a>
<FONT color="green">104</FONT>        }<a name="line.104"></a>
<FONT color="green">105</FONT>    <a name="line.105"></a>
<FONT color="green">106</FONT>    <a name="line.106"></a>
<FONT color="green">107</FONT>    <a name="line.107"></a>
<FONT color="green">108</FONT>        /**<a name="line.108"></a>
<FONT color="green">109</FONT>         * Returns &lt;code&gt;true&lt;/code&gt; if the message key path has a property component.<a name="line.109"></a>
<FONT color="green">110</FONT>         *<a name="line.110"></a>
<FONT color="green">111</FONT>         * @param messageKeyPath the failure message key to use<a name="line.111"></a>
<FONT color="green">112</FONT>         * @return &lt;code&gt;true&lt;/code&gt; if the message key path has a property component<a name="line.112"></a>
<FONT color="green">113</FONT>         */<a name="line.113"></a>
<FONT color="green">114</FONT>        public static boolean hasPropertyKey(String messageKeyPath)<a name="line.114"></a>
<FONT color="green">115</FONT>        {<a name="line.115"></a>
<FONT color="green">116</FONT>            return (messageKeyPath != null) &amp;&amp;<a name="line.116"></a>
<FONT color="green">117</FONT>                              (isValidMessageKeyPath(messageKeyPath)) &amp;&amp;<a name="line.117"></a>
<FONT color="green">118</FONT>                              findPropertyKey(messageKeyPath) != null;<a name="line.118"></a>
<FONT color="green">119</FONT>        }<a name="line.119"></a>
<FONT color="green">120</FONT>    <a name="line.120"></a>
<FONT color="green">121</FONT>    <a name="line.121"></a>
<FONT color="green">122</FONT>    <a name="line.122"></a>
<FONT color="green">123</FONT>        /**<a name="line.123"></a>
<FONT color="green">124</FONT>         * Returns the property key (the middle part of the message key path).<a name="line.124"></a>
<FONT color="green">125</FONT>         *<a name="line.125"></a>
<FONT color="green">126</FONT>         * @param messageKeyPath the failure message key to use<a name="line.126"></a>
<FONT color="green">127</FONT>         * @return the property key<a name="line.127"></a>
<FONT color="green">128</FONT>         */<a name="line.128"></a>
<FONT color="green">129</FONT>        public static String propertyKey(String messageKeyPath)<a name="line.129"></a>
<FONT color="green">130</FONT>        {<a name="line.130"></a>
<FONT color="green">131</FONT>            /** require [has_property_key] hasPropertyKey(messageKeyPath); **/<a name="line.131"></a>
<FONT color="green">132</FONT>            return findPropertyKey(messageKeyPath);<a name="line.132"></a>
<FONT color="green">133</FONT>            /** ensure [valid_result] Result != null; **/<a name="line.133"></a>
<FONT color="green">134</FONT>        }<a name="line.134"></a>
<FONT color="green">135</FONT>    <a name="line.135"></a>
<FONT color="green">136</FONT>    <a name="line.136"></a>
<FONT color="green">137</FONT>    <a name="line.137"></a>
<FONT color="green">138</FONT>        /**<a name="line.138"></a>
<FONT color="green">139</FONT>         * Convenience to create EOFValidation.InvalidValue exceptions in validate&amp;lt;property&amp;gt; methods.<a name="line.139"></a>
<FONT color="green">140</FONT>         *<a name="line.140"></a>
<FONT color="green">141</FONT>         * @param eo the EO object with an invalid value<a name="line.141"></a>
<FONT color="green">142</FONT>         * @param propertyName name of the attribute or relationship that has an invalid value<a name="line.142"></a>
<FONT color="green">143</FONT>         * @param aFailedValue the invalid value<a name="line.143"></a>
<FONT color="green">144</FONT>         * @return EOFValidationException for EOFValidation.InvalidValue<a name="line.144"></a>
<FONT color="green">145</FONT>         */<a name="line.145"></a>
<FONT color="green">146</FONT>        public static EOFValidationException invalidValue(EOEnterpriseObject eo, String propertyName, Object aFailedValue)<a name="line.146"></a>
<FONT color="green">147</FONT>        {<a name="line.147"></a>
<FONT color="green">148</FONT>            /** require<a name="line.148"></a>
<FONT color="green">149</FONT>             [valid_eo_param] eo != null;<a name="line.149"></a>
<FONT color="green">150</FONT>             [valid_propertyName_param] propertyName != null;    **/<a name="line.150"></a>
<FONT color="green">151</FONT>            return new EOFValidationException(eo, propertyName, EOFValidation.InvalidValue, aFailedValue);<a name="line.151"></a>
<FONT color="green">152</FONT>            /** ensure [valid_result] Result != null; **/<a name="line.152"></a>
<FONT color="green">153</FONT>        }<a name="line.153"></a>
<FONT color="green">154</FONT>    <a name="line.154"></a>
<FONT color="green">155</FONT>    <a name="line.155"></a>
<FONT color="green">156</FONT>    <a name="line.156"></a>
<FONT color="green">157</FONT>        /**<a name="line.157"></a>
<FONT color="green">158</FONT>         * Convenience to create EOFValidation.NullNotAllowed exceptions in validate&amp;lt;property&amp;gt; methods.<a name="line.158"></a>
<FONT color="green">159</FONT>         *<a name="line.159"></a>
<FONT color="green">160</FONT>         * @param eo the EO object with a null value<a name="line.160"></a>
<FONT color="green">161</FONT>         * @param propertyName name of the attribute or relationship that has a null value<a name="line.161"></a>
<FONT color="green">162</FONT>         * @return EOFValidationException for EOFValidation.NullNotAllowed<a name="line.162"></a>
<FONT color="green">163</FONT>         */<a name="line.163"></a>
<FONT color="green">164</FONT>        public static EOFValidationException nullNotAllowed(EOEnterpriseObject eo, String propertyName)<a name="line.164"></a>
<FONT color="green">165</FONT>        {<a name="line.165"></a>
<FONT color="green">166</FONT>            /** require<a name="line.166"></a>
<FONT color="green">167</FONT>             [valid_eo_param] eo != null;<a name="line.167"></a>
<FONT color="green">168</FONT>             [valid_propertyName_param] propertyName != null;    **/<a name="line.168"></a>
<FONT color="green">169</FONT>            return new EOFValidationException(eo, propertyName, EOFValidation.NullNotAllowed, null);<a name="line.169"></a>
<FONT color="green">170</FONT>            /** ensure [valid_result] Result != null; **/<a name="line.170"></a>
<FONT color="green">171</FONT>        }<a name="line.171"></a>
<FONT color="green">172</FONT>    <a name="line.172"></a>
<FONT color="green">173</FONT>    <a name="line.173"></a>
<FONT color="green">174</FONT>    <a name="line.174"></a>
<FONT color="green">175</FONT>        /**<a name="line.175"></a>
<FONT color="green">176</FONT>         * This is the constructor to use to general property validation failures.  It constructs the message<a name="line.176"></a>
<FONT color="green">177</FONT>         * key path using the eo's Entity's name, the propertyName, and the failureKey.<a name="line.177"></a>
<FONT color="green">178</FONT>         *<a name="line.178"></a>
<FONT color="green">179</FONT>         * @param eo EOEnterpriseObject that validation failed on, passed to NSValidation.ValidationException constructor as object<a name="line.179"></a>
<FONT color="green">180</FONT>         * @param propertyName optional name of the attribute or relationship that failed to validate<a name="line.180"></a>
<FONT color="green">181</FONT>         * @param failureKey the key (usually an EOFValidation constant) that indicates the type of validation failure<a name="line.181"></a>
<FONT color="green">182</FONT>         * @param aFailedValue the value that failed validation<a name="line.182"></a>
<FONT color="green">183</FONT>         */<a name="line.183"></a>
<FONT color="green">184</FONT>        public EOFValidationException(EOEnterpriseObject eo, String propertyName, String failureKey, Object aFailedValue)<a name="line.184"></a>
<FONT color="green">185</FONT>        {<a name="line.185"></a>
<FONT color="green">186</FONT>            this(eo, eo.entityName(), propertyName, failureKey, aFailedValue);<a name="line.186"></a>
<FONT color="green">187</FONT>            /** require<a name="line.187"></a>
<FONT color="green">188</FONT>            [valid_eo_param] eo != null;<a name="line.188"></a>
<FONT color="green">189</FONT>            [valid_failureKey_param] failureKey != null; **/<a name="line.189"></a>
<FONT color="green">190</FONT>    <a name="line.190"></a>
<FONT color="green">191</FONT>            failedValue = aFailedValue;<a name="line.191"></a>
<FONT color="green">192</FONT>        }<a name="line.192"></a>
<FONT color="green">193</FONT>    <a name="line.193"></a>
<FONT color="green">194</FONT>    <a name="line.194"></a>
<FONT color="green">195</FONT>    <a name="line.195"></a>
<FONT color="green">196</FONT>        /**<a name="line.196"></a>
<FONT color="green">197</FONT>         * This is the constructor to use for validations that affect more than one property, for example in validateForSave().<a name="line.197"></a>
<FONT color="green">198</FONT>         * &lt;code&gt;partialPath&lt;/code&gt; must be a valid failure message key path in the form of &amp;lt;property key&amp;gt;.&amp;lt;failure key&amp;gt;<a name="line.198"></a>
<FONT color="green">199</FONT>         * or just &amp;lt;failure key&amp;gt;.  The entity name is extracted from the eo and this partial path is appended to it to<a name="line.199"></a>
<FONT color="green">200</FONT>         * form a full messageKeyPath.<a name="line.200"></a>
<FONT color="green">201</FONT>         *<a name="line.201"></a>
<FONT color="green">202</FONT>         * @param eo the EO object that failed to validate, passed to NSValidation.ValidationException constructor as object<a name="line.202"></a>
<FONT color="green">203</FONT>         * @param partialPath a partial failure key path<a name="line.203"></a>
<FONT color="green">204</FONT>         */<a name="line.204"></a>
<FONT color="green">205</FONT>        public EOFValidationException(EOEnterpriseObject eo, String partialPath)<a name="line.205"></a>
<FONT color="green">206</FONT>        {<a name="line.206"></a>
<FONT color="green">207</FONT>            this(eo, eo.entityName(), null, partialPath, null);<a name="line.207"></a>
<FONT color="green">208</FONT>            /** require<a name="line.208"></a>
<FONT color="green">209</FONT>            [valid_eo_param] eo != null;<a name="line.209"></a>
<FONT color="green">210</FONT>            [valid_partialPath_param] partialPath != null;<a name="line.210"></a>
<FONT color="green">211</FONT>            [valid_message_keypath] isValidMessageKeyPath(net.global_village.eofextensions.EOObject.entityForSelf(eo).name() + "." + partialPath); **/<a name="line.211"></a>
<FONT color="green">212</FONT>        }<a name="line.212"></a>
<FONT color="green">213</FONT>    <a name="line.213"></a>
<FONT color="green">214</FONT>    <a name="line.214"></a>
<FONT color="green">215</FONT>    <a name="line.215"></a>
<FONT color="green">216</FONT>        /**<a name="line.216"></a>
<FONT color="green">217</FONT>         * Designated constructor.  This is intended for internal use, but may be used for special purposes.<a name="line.217"></a>
<FONT color="green">218</FONT>         *<a name="line.218"></a>
<FONT color="green">219</FONT>         * &lt;p&gt;The message keypath will be formed as &amp;lt;className&amp;gt;.&amp;lt;propertyName&amp;gt;.&amp;lt;failureKey&amp;gt; or &amp;lt;className&amp;gt;.&amp;lt;failureKey&amp;gt;<a name="line.219"></a>
<FONT color="green">220</FONT>         * if propertyName is null.<a name="line.220"></a>
<FONT color="green">221</FONT>         *<a name="line.221"></a>
<FONT color="green">222</FONT>         * @param object optional Object that validation failed on, passed to NSValidation.ValidationException constructor as object<a name="line.222"></a>
<FONT color="green">223</FONT>         * @param className the "name" of object class that validation failed on, usually the EOF entity name but<a name="line.223"></a>
<FONT color="green">224</FONT>         *          must match the name of a .strings file in the Resources.<a name="line.224"></a>
<FONT color="green">225</FONT>         * @param propertyName optional name of the attribute or relationship that failed to validate,<a name="line.225"></a>
<FONT color="green">226</FONT>         *          passed to NSValidation.ValidationException constructor as key<a name="line.226"></a>
<FONT color="green">227</FONT>         * @param failureKey the key (usually an EOFValidation constant) that indicates the type of validation failure<a name="line.227"></a>
<FONT color="green">228</FONT>         * @param aFailedValue the value that failed validation<a name="line.228"></a>
<FONT color="green">229</FONT>         */<a name="line.229"></a>
<FONT color="green">230</FONT>        public EOFValidationException(Object object, String className, String propertyName, String failureKey, Object aFailedValue)<a name="line.230"></a>
<FONT color="green">231</FONT>        {<a name="line.231"></a>
<FONT color="green">232</FONT>            super(className + "." + (propertyName != null ? propertyName + "." : "") + failureKey, object, propertyName);<a name="line.232"></a>
<FONT color="green">233</FONT>            /** require<a name="line.233"></a>
<FONT color="green">234</FONT>            [valid_className_param] className != null;<a name="line.234"></a>
<FONT color="green">235</FONT>            [valid_failureKey_param] failureKey != null; **/<a name="line.235"></a>
<FONT color="green">236</FONT>    <a name="line.236"></a>
<FONT color="green">237</FONT>            failedValue = aFailedValue;<a name="line.237"></a>
<FONT color="green">238</FONT>        }<a name="line.238"></a>
<FONT color="green">239</FONT>    <a name="line.239"></a>
<FONT color="green">240</FONT>    <a name="line.240"></a>
<FONT color="green">241</FONT>    <a name="line.241"></a>
<FONT color="green">242</FONT>        /**<a name="line.242"></a>
<FONT color="green">243</FONT>         * This constructor is intended primarily:<a name="line.243"></a>
<FONT color="green">244</FONT>         * &lt;ul&gt;<a name="line.244"></a>
<FONT color="green">245</FONT>         * &lt;li&gt;to support the other public constructors&lt;/li&gt;<a name="line.245"></a>
<FONT color="green">246</FONT>         * &lt;li&gt;for those rare cases when you want to pass in a custom messageKeyPath&lt;/li&gt;<a name="line.246"></a>
<FONT color="green">247</FONT>         * &lt;/ul&gt;<a name="line.247"></a>
<FONT color="green">248</FONT>         *<a name="line.248"></a>
<FONT color="green">249</FONT>         * &lt;p&gt;Constructs an exception with the same params as the superclass.<a name="line.249"></a>
<FONT color="green">250</FONT>         * &lt;code&gt;messageKeyPath&lt;/code&gt; must be a valid failure message key path.&lt;/p&gt;<a name="line.250"></a>
<FONT color="green">251</FONT>         *<a name="line.251"></a>
<FONT color="green">252</FONT>         * @param messageKeyPath the failure key path in the form of &amp;lt;entity name&amp;gt;.&amp;lt;property key&amp;gt;.&amp;lt;failure key&amp;gt;<a name="line.252"></a>
<FONT color="green">253</FONT>         *<a name="line.253"></a>
<FONT color="green">254</FONT>         * @deprecated If you have a need for this constructor that is not better met by one of the other constructors,<a name="line.254"></a>
<FONT color="green">255</FONT>         * then remove this deprecation and document it's usage in the class JavaDocs.  If this method is removed, it<a name="line.255"></a>
<FONT color="green">256</FONT>         * is worth looking at replacing it with the (String, EOEnterpriseObject) constructor logic and deprecating that<a name="line.256"></a>
<FONT color="green">257</FONT>         * constuctor.  -CH<a name="line.257"></a>
<FONT color="green">258</FONT>         */<a name="line.258"></a>
<FONT color="green">259</FONT>        public EOFValidationException(String messageKeyPath)<a name="line.259"></a>
<FONT color="green">260</FONT>        {<a name="line.260"></a>
<FONT color="green">261</FONT>            super(messageKeyPath, null, null);<a name="line.261"></a>
<FONT color="green">262</FONT>            /** require<a name="line.262"></a>
<FONT color="green">263</FONT>            [valid_messageKeyPath_param] messageKeyPath != null;<a name="line.263"></a>
<FONT color="green">264</FONT>            [valid_message_keypath] isValidMessageKeyPath(messageKeyPath); **/<a name="line.264"></a>
<FONT color="green">265</FONT>        }<a name="line.265"></a>
<FONT color="green">266</FONT>    <a name="line.266"></a>
<FONT color="green">267</FONT>    <a name="line.267"></a>
<FONT color="green">268</FONT>    <a name="line.268"></a>
<FONT color="green">269</FONT>        /**<a name="line.269"></a>
<FONT color="green">270</FONT>         * This constructor is intended primarily:<a name="line.270"></a>
<FONT color="green">271</FONT>         * &lt;ul&gt;<a name="line.271"></a>
<FONT color="green">272</FONT>         * &lt;li&gt;to support the other public constructors&lt;/li&gt;<a name="line.272"></a>
<FONT color="green">273</FONT>         * &lt;li&gt;for those rare cases when you want to pass in a custom messageKeyPath&lt;/li&gt;<a name="line.273"></a>
<FONT color="green">274</FONT>         * &lt;li&gt;for when the object being validated is not an EOEnterprise object&lt;/li&gt;<a name="line.274"></a>
<FONT color="green">275</FONT>         * &lt;/ul&gt;<a name="line.275"></a>
<FONT color="green">276</FONT>         *<a name="line.276"></a>
<FONT color="green">277</FONT>         * &lt;p&gt;Constructs an exception with the same params as the superclass.<a name="line.277"></a>
<FONT color="green">278</FONT>         * &lt;code&gt;messageKeyPath&lt;/code&gt; must be a valid failure message key path.&lt;/p&gt;<a name="line.278"></a>
<FONT color="green">279</FONT>         *<a name="line.279"></a>
<FONT color="green">280</FONT>         * @param messageKeyPath the failure key path in the form of &amp;lt;entity name&amp;gt;.&amp;lt;property key&amp;gt;.&amp;lt;failure key&amp;gt; or &amp;lt;entity name&amp;gt;.&amp;lt;failure key&amp;gt;<a name="line.280"></a>
<FONT color="green">281</FONT>         * @param object the object that failed to validate, passed to NSValidation.ValidationException constructor as the object param<a name="line.281"></a>
<FONT color="green">282</FONT>         *<a name="line.282"></a>
<FONT color="green">283</FONT>         * @deprecated If you have a need for this constructor that is not better met by one of the other constructors,<a name="line.283"></a>
<FONT color="green">284</FONT>         * then remove this deprecation and document it's usage in the class JavaDocs.  If this method is removed, it<a name="line.284"></a>
<FONT color="green">285</FONT>         * is worth looking at replacing it with the (String, EOEnterpriseObject) constructor logic and deprecating that<a name="line.285"></a>
<FONT color="green">286</FONT>         * constuctor.  -CH<a name="line.286"></a>
<FONT color="green">287</FONT>         */<a name="line.287"></a>
<FONT color="green">288</FONT>        public EOFValidationException(String messageKeyPath, Object object)<a name="line.288"></a>
<FONT color="green">289</FONT>        {<a name="line.289"></a>
<FONT color="green">290</FONT>            super(messageKeyPath,<a name="line.290"></a>
<FONT color="green">291</FONT>                  object,<a name="line.291"></a>
<FONT color="green">292</FONT>                  hasPropertyKey(messageKeyPath) ? propertyKey(messageKeyPath) : null);<a name="line.292"></a>
<FONT color="green">293</FONT>            /** require<a name="line.293"></a>
<FONT color="green">294</FONT>            [valid_messageKeyPath_param] messageKeyPath != null;<a name="line.294"></a>
<FONT color="green">295</FONT>            [valid_message_keypath] isValidMessageKeyPath(messageKeyPath); **/<a name="line.295"></a>
<FONT color="green">296</FONT>        }<a name="line.296"></a>
<FONT color="green">297</FONT>    <a name="line.297"></a>
<FONT color="green">298</FONT>    <a name="line.298"></a>
<FONT color="green">299</FONT>    <a name="line.299"></a>
<FONT color="green">300</FONT>        /**<a name="line.300"></a>
<FONT color="green">301</FONT>         * Constructs an exception with the same params as the superclass. &lt;code&gt;messageKeyPath&lt;/code&gt; must be a valid failure message key path.<a name="line.301"></a>
<FONT color="green">302</FONT>         * The propertyKey is derived from the message key path.  This is a shortcut for the constructors that take an attribute or relationship.<a name="line.302"></a>
<FONT color="green">303</FONT>         *<a name="line.303"></a>
<FONT color="green">304</FONT>         * @param messageKeyPath the failure key path in the form of &amp;lt;entity name&amp;gt;.&amp;lt;property key&amp;gt;.&amp;lt;failure key&amp;gt; or &amp;lt;entity name&amp;gt;.&amp;lt;failure key&amp;gt;<a name="line.304"></a>
<FONT color="green">305</FONT>         * @param object the EO object that failed to validate, passed to NSValidation.ValidationException constructor as object<a name="line.305"></a>
<FONT color="green">306</FONT>         * @param aFailedValue the value that failed validation<a name="line.306"></a>
<FONT color="green">307</FONT>         *<a name="line.307"></a>
<FONT color="green">308</FONT>         * @deprecated If you have a need for this constructor that is not better met by one of the other constructors,<a name="line.308"></a>
<FONT color="green">309</FONT>         * then remove this deprecation and document it's usage in the class JavaDocs.  If this method is removed, it<a name="line.309"></a>
<FONT color="green">310</FONT>         * is worth looking at replacing it with the (String, EOEnterpriseObject) constructor logic and deprecating that<a name="line.310"></a>
<FONT color="green">311</FONT>         * constuctor.  -CH<a name="line.311"></a>
<FONT color="green">312</FONT>         */<a name="line.312"></a>
<FONT color="green">313</FONT>        public EOFValidationException(String messageKeyPath, EOEnterpriseObject object, Object aFailedValue)<a name="line.313"></a>
<FONT color="green">314</FONT>        {<a name="line.314"></a>
<FONT color="green">315</FONT>            this(messageKeyPath, object);<a name="line.315"></a>
<FONT color="green">316</FONT>            /** require<a name="line.316"></a>
<FONT color="green">317</FONT>            [valid_messageKeyPath_param] messageKeyPath != null;<a name="line.317"></a>
<FONT color="green">318</FONT>            [valid_message_keypath] isValidMessageKeyPath(messageKeyPath); **/<a name="line.318"></a>
<FONT color="green">319</FONT>    <a name="line.319"></a>
<FONT color="green">320</FONT>            failedValue = aFailedValue;<a name="line.320"></a>
<FONT color="green">321</FONT>        }<a name="line.321"></a>
<FONT color="green">322</FONT>    <a name="line.322"></a>
<FONT color="green">323</FONT>    <a name="line.323"></a>
<FONT color="green">324</FONT>    <a name="line.324"></a>
<FONT color="green">325</FONT>        /**<a name="line.325"></a>
<FONT color="green">326</FONT>         * This method is for internal use by EOAttributeValidator.<a name="line.326"></a>
<FONT color="green">327</FONT>         * Constructs the message key path using the EOAttribute and a failureKey.<a name="line.327"></a>
<FONT color="green">328</FONT>         *<a name="line.328"></a>
<FONT color="green">329</FONT>         * @param attribute the attribute that failed to validate<a name="line.329"></a>
<FONT color="green">330</FONT>         * @param failureKey the key from EOFValidation that indicates the type of validation failure<a name="line.330"></a>
<FONT color="green">331</FONT>         * @param aFailedValue the value that failed validation<a name="line.331"></a>
<FONT color="green">332</FONT>         *<a name="line.332"></a>
<FONT color="green">333</FONT>         * @deprecated If you have a need for this constructor that is not better met by one of the other constructors,<a name="line.333"></a>
<FONT color="green">334</FONT>         * then remove this deprecation and document it's usage in the class JavaDocs.  If this method is removed, it<a name="line.334"></a>
<FONT color="green">335</FONT>         * is worth looking at replacing it with the (String, EOEnterpriseObject) constructor logic and deprecating that<a name="line.335"></a>
<FONT color="green">336</FONT>         * constuctor.  -CH<a name="line.336"></a>
<FONT color="green">337</FONT>         */<a name="line.337"></a>
<FONT color="green">338</FONT>        public EOFValidationException(EOAttribute attribute, String failureKey, Object aFailedValue)<a name="line.338"></a>
<FONT color="green">339</FONT>        {<a name="line.339"></a>
<FONT color="green">340</FONT>            this(attribute.entity().name() + "." + attribute.name() + "." + failureKey);<a name="line.340"></a>
<FONT color="green">341</FONT>            /** require<a name="line.341"></a>
<FONT color="green">342</FONT>            [valid_attribute_param] attribute != null;<a name="line.342"></a>
<FONT color="green">343</FONT>            [valid_failureKey_param] failureKey != null; **/<a name="line.343"></a>
<FONT color="green">344</FONT>    <a name="line.344"></a>
<FONT color="green">345</FONT>            failedValue = aFailedValue;<a name="line.345"></a>
<FONT color="green">346</FONT>        }<a name="line.346"></a>
<FONT color="green">347</FONT>    <a name="line.347"></a>
<FONT color="green">348</FONT>    <a name="line.348"></a>
<FONT color="green">349</FONT>    <a name="line.349"></a>
<FONT color="green">350</FONT>        /**<a name="line.350"></a>
<FONT color="green">351</FONT>         * This method is for internal use by EOAttributeValidator.<a name="line.351"></a>
<FONT color="green">352</FONT>         * Constructs the message key path using the EORelationship and a failureKey.<a name="line.352"></a>
<FONT color="green">353</FONT>         *<a name="line.353"></a>
<FONT color="green">354</FONT>         * @param relationship the relationship that failed to validate<a name="line.354"></a>
<FONT color="green">355</FONT>         * @param failureKey the key from EOFValidation that indicates the type of validation failure<a name="line.355"></a>
<FONT color="green">356</FONT>         * @param newFailedValue the value that failed to validate<a name="line.356"></a>
<FONT color="green">357</FONT>         *<a name="line.357"></a>
<FONT color="green">358</FONT>         * @deprecated If you have a need for this constructor that is not better met by one of the other constructors,<a name="line.358"></a>
<FONT color="green">359</FONT>         * then remove this deprecation and document it's usage in the class JavaDocs.  If this method is removed, it<a name="line.359"></a>
<FONT color="green">360</FONT>         * is worth looking at replacing it with the (String, EOEnterpriseObject) constructor logic and deprecating that<a name="line.360"></a>
<FONT color="green">361</FONT>         * constuctor.  -CH<a name="line.361"></a>
<FONT color="green">362</FONT>         */<a name="line.362"></a>
<FONT color="green">363</FONT>        public EOFValidationException(EORelationship relationship, String failureKey, Object newFailedValue)<a name="line.363"></a>
<FONT color="green">364</FONT>        {<a name="line.364"></a>
<FONT color="green">365</FONT>            super(relationship.entity().name() + "." + relationship.name() + "." + failureKey);<a name="line.365"></a>
<FONT color="green">366</FONT>            /** require<a name="line.366"></a>
<FONT color="green">367</FONT>            [valid_relationship_param] relationship != null;<a name="line.367"></a>
<FONT color="green">368</FONT>            [valid_failureKey_param] failureKey != null; **/<a name="line.368"></a>
<FONT color="green">369</FONT>    <a name="line.369"></a>
<FONT color="green">370</FONT>            failedValue = newFailedValue;<a name="line.370"></a>
<FONT color="green">371</FONT>        }<a name="line.371"></a>
<FONT color="green">372</FONT>    <a name="line.372"></a>
<FONT color="green">373</FONT>    <a name="line.373"></a>
<FONT color="green">374</FONT>    <a name="line.374"></a>
<FONT color="green">375</FONT>        /**<a name="line.375"></a>
<FONT color="green">376</FONT>         * Returns the entity name (the first part of the message key path).<a name="line.376"></a>
<FONT color="green">377</FONT>         *<a name="line.377"></a>
<FONT color="green">378</FONT>         * @return the entity name (the first part of the message key path)<a name="line.378"></a>
<FONT color="green">379</FONT>         */<a name="line.379"></a>
<FONT color="green">380</FONT>        public String entityName()<a name="line.380"></a>
<FONT color="green">381</FONT>        {<a name="line.381"></a>
<FONT color="green">382</FONT>            String firstPart = StringAdditions.objectKeyPathFromKeyPath(super.getMessage());<a name="line.382"></a>
<FONT color="green">383</FONT>            if (StringAdditions.isValidPropertyKeyPath(firstPart))<a name="line.383"></a>
<FONT color="green">384</FONT>            {<a name="line.384"></a>
<FONT color="green">385</FONT>                firstPart = StringAdditions.objectKeyPathFromKeyPath(firstPart);<a name="line.385"></a>
<FONT color="green">386</FONT>            }<a name="line.386"></a>
<FONT color="green">387</FONT>            return firstPart;<a name="line.387"></a>
<FONT color="green">388</FONT>    <a name="line.388"></a>
<FONT color="green">389</FONT>            /** ensure [valid_result] Result != null; **/<a name="line.389"></a>
<FONT color="green">390</FONT>        }<a name="line.390"></a>
<FONT color="green">391</FONT>    <a name="line.391"></a>
<FONT color="green">392</FONT>    <a name="line.392"></a>
<FONT color="green">393</FONT>        /**<a name="line.393"></a>
<FONT color="green">394</FONT>         * Returns the entity (from the first part of the message key path).<a name="line.394"></a>
<FONT color="green">395</FONT>         *<a name="line.395"></a>
<FONT color="green">396</FONT>         * @return the entity<a name="line.396"></a>
<FONT color="green">397</FONT>         */<a name="line.397"></a>
<FONT color="green">398</FONT>        public EOEntity entity()<a name="line.398"></a>
<FONT color="green">399</FONT>        {<a name="line.399"></a>
<FONT color="green">400</FONT>            return EOModelGroup.defaultGroup().entityNamed(entityName());<a name="line.400"></a>
<FONT color="green">401</FONT>        }<a name="line.401"></a>
<FONT color="green">402</FONT>    <a name="line.402"></a>
<FONT color="green">403</FONT>    <a name="line.403"></a>
<FONT color="green">404</FONT>        /**<a name="line.404"></a>
<FONT color="green">405</FONT>         * Returns &lt;code&gt;true&lt;/code&gt; if the message key path has a property component.<a name="line.405"></a>
<FONT color="green">406</FONT>         *<a name="line.406"></a>
<FONT color="green">407</FONT>         * @return &lt;code&gt;true&lt;/code&gt; if the message key path has a property component<a name="line.407"></a>
<FONT color="green">408</FONT>         */<a name="line.408"></a>
<FONT color="green">409</FONT>        public boolean hasPropertyKey()<a name="line.409"></a>
<FONT color="green">410</FONT>        {<a name="line.410"></a>
<FONT color="green">411</FONT>            return findPropertyKey(super.getMessage()) != null;<a name="line.411"></a>
<FONT color="green">412</FONT>        }<a name="line.412"></a>
<FONT color="green">413</FONT>    <a name="line.413"></a>
<FONT color="green">414</FONT>    <a name="line.414"></a>
<FONT color="green">415</FONT>        /**<a name="line.415"></a>
<FONT color="green">416</FONT>         * Returns the property key (the middle part of the message key path).<a name="line.416"></a>
<FONT color="green">417</FONT>         *<a name="line.417"></a>
<FONT color="green">418</FONT>         * @return the property key<a name="line.418"></a>
<FONT color="green">419</FONT>         */<a name="line.419"></a>
<FONT color="green">420</FONT>        public String propertyKey()<a name="line.420"></a>
<FONT color="green">421</FONT>        {<a name="line.421"></a>
<FONT color="green">422</FONT>            /** require [has_property_key] hasPropertyKey(super.getMessage()); **/<a name="line.422"></a>
<FONT color="green">423</FONT>            return findPropertyKey(super.getMessage());<a name="line.423"></a>
<FONT color="green">424</FONT>            /** ensure [valid_result] Result != null; **/<a name="line.424"></a>
<FONT color="green">425</FONT>        }<a name="line.425"></a>
<FONT color="green">426</FONT>    <a name="line.426"></a>
<FONT color="green">427</FONT>    <a name="line.427"></a>
<FONT color="green">428</FONT>        /**<a name="line.428"></a>
<FONT color="green">429</FONT>         * Returns &lt;code&gt;true&lt;/code&gt; if the property key refers to an attribute.<a name="line.429"></a>
<FONT color="green">430</FONT>         *<a name="line.430"></a>
<FONT color="green">431</FONT>         * @return &lt;code&gt;true&lt;/code&gt; if the property key refers to an attribute<a name="line.431"></a>
<FONT color="green">432</FONT>         */<a name="line.432"></a>
<FONT color="green">433</FONT>        public boolean propertyKeyRefersToAttribute()<a name="line.433"></a>
<FONT color="green">434</FONT>        {<a name="line.434"></a>
<FONT color="green">435</FONT>            /** require [has_property_key] hasPropertyKey(); **/<a name="line.435"></a>
<FONT color="green">436</FONT>    <a name="line.436"></a>
<FONT color="green">437</FONT>            return entity().attributeNamed(propertyKey()) != null;<a name="line.437"></a>
<FONT color="green">438</FONT>        }<a name="line.438"></a>
<FONT color="green">439</FONT>    <a name="line.439"></a>
<FONT color="green">440</FONT>    <a name="line.440"></a>
<FONT color="green">441</FONT>        /**<a name="line.441"></a>
<FONT color="green">442</FONT>         * Returns the property key as an attribute.<a name="line.442"></a>
<FONT color="green">443</FONT>         *<a name="line.443"></a>
<FONT color="green">444</FONT>         * @return the property key as an attribute<a name="line.444"></a>
<FONT color="green">445</FONT>         */<a name="line.445"></a>
<FONT color="green">446</FONT>        public EOAttribute propertyKeyAsAttribute()<a name="line.446"></a>
<FONT color="green">447</FONT>        {<a name="line.447"></a>
<FONT color="green">448</FONT>            /** require<a name="line.448"></a>
<FONT color="green">449</FONT>            [has_property_key] hasPropertyKey();<a name="line.449"></a>
<FONT color="green">450</FONT>            [property_key_refers_to_attribute] propertyKeyRefersToAttribute(); **/<a name="line.450"></a>
<FONT color="green">451</FONT>    <a name="line.451"></a>
<FONT color="green">452</FONT>            return entity().attributeNamed(propertyKey());<a name="line.452"></a>
<FONT color="green">453</FONT>        }<a name="line.453"></a>
<FONT color="green">454</FONT>    <a name="line.454"></a>
<FONT color="green">455</FONT>    <a name="line.455"></a>
<FONT color="green">456</FONT>        /**<a name="line.456"></a>
<FONT color="green">457</FONT>         * Returns the failure key (the last part of the message key path).<a name="line.457"></a>
<FONT color="green">458</FONT>         *<a name="line.458"></a>
<FONT color="green">459</FONT>         * @return the failure key (the last part of the message key path)<a name="line.459"></a>
<FONT color="green">460</FONT>         */<a name="line.460"></a>
<FONT color="green">461</FONT>        public String failureKey()<a name="line.461"></a>
<FONT color="green">462</FONT>        {<a name="line.462"></a>
<FONT color="green">463</FONT>            return StringAdditions.propertyNameFromKeyPath(super.getMessage());<a name="line.463"></a>
<FONT color="green">464</FONT>    <a name="line.464"></a>
<FONT color="green">465</FONT>            /** ensure [valid_result] Result != null; **/<a name="line.465"></a>
<FONT color="green">466</FONT>        }<a name="line.466"></a>
<FONT color="green">467</FONT>    <a name="line.467"></a>
<FONT color="green">468</FONT>    <a name="line.468"></a>
<FONT color="green">469</FONT>    <a name="line.469"></a>
<FONT color="green">470</FONT>        /**<a name="line.470"></a>
<FONT color="green">471</FONT>         * Sets the value that failed to validate.<a name="line.471"></a>
<FONT color="green">472</FONT>         *<a name="line.472"></a>
<FONT color="green">473</FONT>         * @param newFailedValue the value that failed to validate<a name="line.473"></a>
<FONT color="green">474</FONT>         */<a name="line.474"></a>
<FONT color="green">475</FONT>        public void setFailedValue(Object newFailedValue)<a name="line.475"></a>
<FONT color="green">476</FONT>        {<a name="line.476"></a>
<FONT color="green">477</FONT>            failedValue = newFailedValue;<a name="line.477"></a>
<FONT color="green">478</FONT>        }<a name="line.478"></a>
<FONT color="green">479</FONT>    <a name="line.479"></a>
<FONT color="green">480</FONT>    <a name="line.480"></a>
<FONT color="green">481</FONT>        /**<a name="line.481"></a>
<FONT color="green">482</FONT>         * Returns the value that failed to validate.<a name="line.482"></a>
<FONT color="green">483</FONT>         *<a name="line.483"></a>
<FONT color="green">484</FONT>         * @return the value that failed to validate<a name="line.484"></a>
<FONT color="green">485</FONT>         */<a name="line.485"></a>
<FONT color="green">486</FONT>        public Object failedValue()<a name="line.486"></a>
<FONT color="green">487</FONT>        {<a name="line.487"></a>
<FONT color="green">488</FONT>            return failedValue;<a name="line.488"></a>
<FONT color="green">489</FONT>        }<a name="line.489"></a>
<FONT color="green">490</FONT>    <a name="line.490"></a>
<FONT color="green">491</FONT>    <a name="line.491"></a>
<FONT color="green">492</FONT>    <a name="line.492"></a>
<FONT color="green">493</FONT>        /**<a name="line.493"></a>
<FONT color="green">494</FONT>         * Returns a dictionary with keys used to substitute values in the localized error message:<a name="line.494"></a>
<FONT color="green">495</FONT>         * &lt;ul&gt;<a name="line.495"></a>
<FONT color="green">496</FONT>         * &lt;li&gt;EOFValidation.EntityFailedOn&lt;/li&gt;<a name="line.496"></a>
<FONT color="green">497</FONT>         * &lt;li&gt;EOFValidation.EntityName&lt;/li&gt;<a name="line.497"></a>
<FONT color="green">498</FONT>         * &lt;li&gt;EOFValidation.EntityName&lt;/li&gt;<a name="line.498"></a>
<FONT color="green">499</FONT>         * &lt;li&gt;EOFValidation.FailedValue&lt;/li&gt;<a name="line.499"></a>
<FONT color="green">500</FONT>         * &lt;li&gt;EOFValidation.ObjectFailedOn&lt;/li&gt;<a name="line.500"></a>
<FONT color="green">501</FONT>         * &lt;li&gt;EOFValidation.PropertyName&lt;/li&gt;<a name="line.501"></a>
<FONT color="green">502</FONT>         * &lt;li&gt;EOFValidation.AttributeFailedOn&lt;/li&gt;<a name="line.502"></a>
<FONT color="green">503</FONT>         * &lt;/ul&gt;<a name="line.503"></a>
<FONT color="green">504</FONT>         *<a name="line.504"></a>
<FONT color="green">505</FONT>         * @return a dictionary with keys used to substitute values in the localized error message<a name="line.505"></a>
<FONT color="green">506</FONT>         */<a name="line.506"></a>
<FONT color="green">507</FONT>        protected NSDictionary substitutionDictionary()<a name="line.507"></a>
<FONT color="green">508</FONT>        {<a name="line.508"></a>
<FONT color="green">509</FONT>            NSMutableDictionary dictionary = new NSMutableDictionary();<a name="line.509"></a>
<FONT color="green">510</FONT>    <a name="line.510"></a>
<FONT color="green">511</FONT>            if (entity() != null)<a name="line.511"></a>
<FONT color="green">512</FONT>            {<a name="line.512"></a>
<FONT color="green">513</FONT>                dictionary.setObjectForKey(entity(), EOFValidation.EntityFailedOn);<a name="line.513"></a>
<FONT color="green">514</FONT>                dictionary.setObjectForKey(EOEntityAdditions.displayNameForEntity(entity()), EOFValidation.EntityName);<a name="line.514"></a>
<FONT color="green">515</FONT>            }<a name="line.515"></a>
<FONT color="green">516</FONT>            else<a name="line.516"></a>
<FONT color="green">517</FONT>            {<a name="line.517"></a>
<FONT color="green">518</FONT>                dictionary.setObjectForKey(entityName(), EOFValidation.EntityName);<a name="line.518"></a>
<FONT color="green">519</FONT>            }<a name="line.519"></a>
<FONT color="green">520</FONT>    <a name="line.520"></a>
<FONT color="green">521</FONT>            if (failedValue() != null)<a name="line.521"></a>
<FONT color="green">522</FONT>            {<a name="line.522"></a>
<FONT color="green">523</FONT>                dictionary.setObjectForKey(failedValue(), EOFValidation.FailedValue);<a name="line.523"></a>
<FONT color="green">524</FONT>            }<a name="line.524"></a>
<FONT color="green">525</FONT>    <a name="line.525"></a>
<FONT color="green">526</FONT>            if (object() != null)<a name="line.526"></a>
<FONT color="green">527</FONT>            {<a name="line.527"></a>
<FONT color="green">528</FONT>                dictionary.setObjectForKey(object(), EOFValidation.ObjectFailedOn);<a name="line.528"></a>
<FONT color="green">529</FONT>            }<a name="line.529"></a>
<FONT color="green">530</FONT>    <a name="line.530"></a>
<FONT color="green">531</FONT>            if (entity() != null &amp;&amp; hasPropertyKey())<a name="line.531"></a>
<FONT color="green">532</FONT>            {<a name="line.532"></a>
<FONT color="green">533</FONT>                dictionary.setObjectForKey(EOEntityAdditions.displayNameForPropertyNamed(propertyKey(), entity()), EOFValidation.PropertyName);<a name="line.533"></a>
<FONT color="green">534</FONT>    <a name="line.534"></a>
<FONT color="green">535</FONT>                if (propertyKeyRefersToAttribute())<a name="line.535"></a>
<FONT color="green">536</FONT>                {<a name="line.536"></a>
<FONT color="green">537</FONT>                    dictionary.setObjectForKey(propertyKeyAsAttribute(), EOFValidation.AttributeFailedOn);<a name="line.537"></a>
<FONT color="green">538</FONT>                }<a name="line.538"></a>
<FONT color="green">539</FONT>                // CHECKME not sure if we need the same for relationships...<a name="line.539"></a>
<FONT color="green">540</FONT>            }<a name="line.540"></a>
<FONT color="green">541</FONT>    <a name="line.541"></a>
<FONT color="green">542</FONT>            return dictionary;<a name="line.542"></a>
<FONT color="green">543</FONT>    <a name="line.543"></a>
<FONT color="green">544</FONT>            /** ensure [valid_result] Result != null; **/<a name="line.544"></a>
<FONT color="green">545</FONT>        }<a name="line.545"></a>
<FONT color="green">546</FONT>    <a name="line.546"></a>
<FONT color="green">547</FONT>    <a name="line.547"></a>
<FONT color="green">548</FONT>    <a name="line.548"></a>
<FONT color="green">549</FONT>        /**<a name="line.549"></a>
<FONT color="green">550</FONT>         * @return getLocalizedMessage()<a name="line.550"></a>
<FONT color="green">551</FONT>         * @see #getLocalizedMessage(NSArray)<a name="line.551"></a>
<FONT color="green">552</FONT>         */<a name="line.552"></a>
<FONT color="green">553</FONT>        public String getMessage()<a name="line.553"></a>
<FONT color="green">554</FONT>        {<a name="line.554"></a>
<FONT color="green">555</FONT>            return getLocalizedMessage();<a name="line.555"></a>
<FONT color="green">556</FONT>            /** ensure [valid_result] Result != null; **/<a name="line.556"></a>
<FONT color="green">557</FONT>        }<a name="line.557"></a>
<FONT color="green">558</FONT>    <a name="line.558"></a>
<FONT color="green">559</FONT>    <a name="line.559"></a>
<FONT color="green">560</FONT>    <a name="line.560"></a>
<FONT color="green">561</FONT>        /**<a name="line.561"></a>
<FONT color="green">562</FONT>         * Returns a localized message based on the message key path returned by super.getMessage().  Note that the localization is based on the &lt;em&gt;server's&lt;/em&gt; locale, so this method is not appropriate for web apps.<a name="line.562"></a>
<FONT color="green">563</FONT>         *<a name="line.563"></a>
<FONT color="green">564</FONT>         * @return the localized message<a name="line.564"></a>
<FONT color="green">565</FONT>         * @see #getLocalizedMessage(NSArray)<a name="line.565"></a>
<FONT color="green">566</FONT>         */<a name="line.566"></a>
<FONT color="green">567</FONT>        public String getLocalizedMessage()<a name="line.567"></a>
<FONT color="green">568</FONT>        {<a name="line.568"></a>
<FONT color="green">569</FONT>            // If we can't localize the string, better return some information than a pre-condition exception with no context<a name="line.569"></a>
<FONT color="green">570</FONT>            if ( ! LocalizationEngine.localizedStringExists(entityName(), hasPropertyKey() ? propertyKey() : null, failureKey()))<a name="line.570"></a>
<FONT color="green">571</FONT>            {<a name="line.571"></a>
<FONT color="green">572</FONT>                return "Can't localize message: " + super.getLocalizedMessage();<a name="line.572"></a>
<FONT color="green">573</FONT>            }<a name="line.573"></a>
<FONT color="green">574</FONT>    <a name="line.574"></a>
<FONT color="green">575</FONT>            String propertyKey = hasPropertyKey() ? propertyKey() : null;<a name="line.575"></a>
<FONT color="green">576</FONT>            String localizedTemplate = LocalizationEngine.localizedString(entityName(), propertyKey, failureKey());<a name="line.576"></a>
<FONT color="green">577</FONT>    <a name="line.577"></a>
<FONT color="green">578</FONT>            /*<a name="line.578"></a>
<FONT color="green">579</FONT>             * This was added to accommodate TestNG which produces a post test report by calling toString<a name="line.579"></a>
<FONT color="green">580</FONT>             * on exceptions raised during test failures.  This causes an exception as any EO in this exception<a name="line.580"></a>
<FONT color="green">581</FONT>             * was in an EC long since disposed.<a name="line.581"></a>
<FONT color="green">582</FONT>             */<a name="line.582"></a>
<FONT color="green">583</FONT>            if (object() != null &amp;&amp; object() instanceof EOEnterpriseObject)<a name="line.583"></a>
<FONT color="green">584</FONT>            {<a name="line.584"></a>
<FONT color="green">585</FONT>                try<a name="line.585"></a>
<FONT color="green">586</FONT>                {<a name="line.586"></a>
<FONT color="green">587</FONT>                    ((EOEnterpriseObject)object()).willRead();<a name="line.587"></a>
<FONT color="green">588</FONT>                }<a name="line.588"></a>
<FONT color="green">589</FONT>                catch (IllegalStateException e)<a name="line.589"></a>
<FONT color="green">590</FONT>                {<a name="line.590"></a>
<FONT color="green">591</FONT>                    return localizedTemplate + " (ec disposed, substitution not possible, entity " + entityName() + ", property " + propertyKey + ")";<a name="line.591"></a>
<FONT color="green">592</FONT>                }<a name="line.592"></a>
<FONT color="green">593</FONT>    <a name="line.593"></a>
<FONT color="green">594</FONT>            }<a name="line.594"></a>
<FONT color="green">595</FONT>    <a name="line.595"></a>
<FONT color="green">596</FONT>            return TemplateSubstitution.substituteValuesInStringFromDictionary(localizedTemplate, substitutionDictionary());<a name="line.596"></a>
<FONT color="green">597</FONT>    <a name="line.597"></a>
<FONT color="green">598</FONT>            /** ensure [valid_result] Result != null; **/<a name="line.598"></a>
<FONT color="green">599</FONT>        }<a name="line.599"></a>
<FONT color="green">600</FONT>    <a name="line.600"></a>
<FONT color="green">601</FONT>    <a name="line.601"></a>
<FONT color="green">602</FONT>        /**<a name="line.602"></a>
<FONT color="green">603</FONT>         * Returns a localized message based on the message key path returned by super.getMessage().  Note that the localization is based on the &lt;em&gt;server's&lt;/em&gt; locale, so this method is not appropriate for web apps.<a name="line.603"></a>
<FONT color="green">604</FONT>         *<a name="line.604"></a>
<FONT color="green">605</FONT>         * @param languages the array of languages to localize for<a name="line.605"></a>
<FONT color="green">606</FONT>         * @return the localized message<a name="line.606"></a>
<FONT color="green">607</FONT>         * @see #getLocalizedMessage(NSArray)<a name="line.607"></a>
<FONT color="green">608</FONT>         */<a name="line.608"></a>
<FONT color="green">609</FONT>        public String getLocalizedMessage(NSArray languages)<a name="line.609"></a>
<FONT color="green">610</FONT>        {<a name="line.610"></a>
<FONT color="green">611</FONT>            /** require<a name="line.611"></a>
<FONT color="green">612</FONT>            [valid_param] languages != null;<a name="line.612"></a>
<FONT color="green">613</FONT>            [localized_message_exists] LocalizationEngine.localizedStringExists(entityName(), hasPropertyKey() ? propertyKey() : null, failureKey(), languages); **/<a name="line.613"></a>
<FONT color="green">614</FONT>    <a name="line.614"></a>
<FONT color="green">615</FONT>            String propertyKey = hasPropertyKey() ? propertyKey() : null;<a name="line.615"></a>
<FONT color="green">616</FONT>            String localizedTemplate = LocalizationEngine.localizedString(entityName(), propertyKey, failureKey(), languages);<a name="line.616"></a>
<FONT color="green">617</FONT>            return TemplateSubstitution.substituteValuesInStringFromDictionary(localizedTemplate, substitutionDictionary());<a name="line.617"></a>
<FONT color="green">618</FONT>    <a name="line.618"></a>
<FONT color="green">619</FONT>            /** ensure [valid_result] Result != null; **/<a name="line.619"></a>
<FONT color="green">620</FONT>        }<a name="line.620"></a>
<FONT color="green">621</FONT>    <a name="line.621"></a>
<FONT color="green">622</FONT>    <a name="line.622"></a>
<FONT color="green">623</FONT>    <a name="line.623"></a>
<FONT color="green">624</FONT>        /**<a name="line.624"></a>
<FONT color="green">625</FONT>         * Returns an array of localized messages based on the message key path returned by super.getMessage() of this exception and any exceptions in this' &lt;code&gt;additionalExceptions()&lt;/code&gt;.  Note that the localization is based on the &lt;em&gt;server's&lt;/em&gt; locale, so this method is not appropriate for web apps.<a name="line.625"></a>
<FONT color="green">626</FONT>         *<a name="line.626"></a>
<FONT color="green">627</FONT>         * @see #getLocalizedMessage()<a name="line.627"></a>
<FONT color="green">628</FONT>         *<a name="line.628"></a>
<FONT color="green">629</FONT>         * @return an array of localized messages, one message per exception<a name="line.629"></a>
<FONT color="green">630</FONT>         */<a name="line.630"></a>
<FONT color="green">631</FONT>        public NSArray getLocalizedMessageForUnaggregatedExceptions()<a name="line.631"></a>
<FONT color="green">632</FONT>        {<a name="line.632"></a>
<FONT color="green">633</FONT>            return ValidationExceptionAdditions.localizedMessagesForUnaggregatedExceptions(this);<a name="line.633"></a>
<FONT color="green">634</FONT>            /** ensure [valid_result] Result != null; **/<a name="line.634"></a>
<FONT color="green">635</FONT>        }<a name="line.635"></a>
<FONT color="green">636</FONT>    <a name="line.636"></a>
<FONT color="green">637</FONT>    <a name="line.637"></a>
<FONT color="green">638</FONT>    <a name="line.638"></a>
<FONT color="green">639</FONT>        /**<a name="line.639"></a>
<FONT color="green">640</FONT>         * Returns &lt;code&gt;true&lt;/code&gt; if this exception is for the indicated type of validation failure on the named property.  This can be useful when implementing specific validation exception handling.<a name="line.640"></a>
<FONT color="green">641</FONT>         *<a name="line.641"></a>
<FONT color="green">642</FONT>         * @param propertyKey the name of the property to match for this failure. &lt;code&gt;null&lt;/code&gt; matches when &lt;code&gt;propertyKey()&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;<a name="line.642"></a>
<FONT color="green">643</FONT>         * @param failureKey the type of validation failure.  See EOFValidation<a name="line.643"></a>
<FONT color="green">644</FONT>         * @return &lt;code&gt;true&lt;/code&gt; if this exception equals the indicated type of validation failure on the named property<a name="line.644"></a>
<FONT color="green">645</FONT>         */<a name="line.645"></a>
<FONT color="green">646</FONT>        public boolean isExceptionForFailure(String propertyKey, String failureKey)<a name="line.646"></a>
<FONT color="green">647</FONT>        {<a name="line.647"></a>
<FONT color="green">648</FONT>            /** require<a name="line.648"></a>
<FONT color="green">649</FONT>            [valid_failureKey_param] failureKey != null;<a name="line.649"></a>
<FONT color="green">650</FONT>            [failureKey_is_a_valid_key] EOFValidation.setOfAllFailureKeys.containsObject(failureKey); **/<a name="line.650"></a>
<FONT color="green">651</FONT>    <a name="line.651"></a>
<FONT color="green">652</FONT>            boolean failureKeyMatches = failureKey().equals(failureKey);<a name="line.652"></a>
<FONT color="green">653</FONT>            boolean propertyKeyMatches;<a name="line.653"></a>
<FONT color="green">654</FONT>    <a name="line.654"></a>
<FONT color="green">655</FONT>            if (hasPropertyKey())<a name="line.655"></a>
<FONT color="green">656</FONT>            {<a name="line.656"></a>
<FONT color="green">657</FONT>                propertyKeyMatches = propertyKey.equals(propertyKey());<a name="line.657"></a>
<FONT color="green">658</FONT>            }<a name="line.658"></a>
<FONT color="green">659</FONT>            else<a name="line.659"></a>
<FONT color="green">660</FONT>            {<a name="line.660"></a>
<FONT color="green">661</FONT>                propertyKeyMatches = propertyKey == null;<a name="line.661"></a>
<FONT color="green">662</FONT>            }<a name="line.662"></a>
<FONT color="green">663</FONT>    <a name="line.663"></a>
<FONT color="green">664</FONT>            return failureKeyMatches &amp;&amp; propertyKeyMatches;<a name="line.664"></a>
<FONT color="green">665</FONT>        }<a name="line.665"></a>
<FONT color="green">666</FONT>    <a name="line.666"></a>
<FONT color="green">667</FONT>    <a name="line.667"></a>
<FONT color="green">668</FONT>    <a name="line.668"></a>
<FONT color="green">669</FONT>        /**<a name="line.669"></a>
<FONT color="green">670</FONT>         * Helper method for &lt;code&gt;doesFailureExist&lt;/code&gt; and &lt;code&gt;exceptionForFailure&lt;/code&gt;.<a name="line.670"></a>
<FONT color="green">671</FONT>         *<a name="line.671"></a>
<FONT color="green">672</FONT>         * @param propertyKey the name of the property to match for this failure.<a name="line.672"></a>
<FONT color="green">673</FONT>         * @param failureKey the type of validation failure.  See EOFValidation<a name="line.673"></a>
<FONT color="green">674</FONT>         * @return &lt;code&gt;true&lt;/code&gt; if this exception or any of it's additional exceptions equals the indicated type of validation failure on the named property<a name="line.674"></a>
<FONT color="green">675</FONT>         */<a name="line.675"></a>
<FONT color="green">676</FONT>        protected EOFValidationException findExceptionForFailure(String propertyKey, String failureKey)<a name="line.676"></a>
<FONT color="green">677</FONT>        {<a name="line.677"></a>
<FONT color="green">678</FONT>            /** require<a name="line.678"></a>
<FONT color="green">679</FONT>            [valid_propertyKey_param] propertyKey != null;<a name="line.679"></a>
<FONT color="green">680</FONT>            [valid_failureKey_param] failureKey != null;<a name="line.680"></a>
<FONT color="green">681</FONT>            [failureKey_is_a_valid_key] EOFValidation.setOfAllFailureKeys.containsObject(failureKey); **/<a name="line.681"></a>
<FONT color="green">682</FONT>    <a name="line.682"></a>
<FONT color="green">683</FONT>            EOFValidationException exceptionForFailure = null;<a name="line.683"></a>
<FONT color="green">684</FONT>            Enumeration exceptions = ValidationExceptionAdditions.unaggregateExceptions(this).objectEnumerator();<a name="line.684"></a>
<FONT color="green">685</FONT>            while (exceptions.hasMoreElements())<a name="line.685"></a>
<FONT color="green">686</FONT>            {<a name="line.686"></a>
<FONT color="green">687</FONT>                EOFValidationException subException = (EOFValidationException)exceptions.nextElement();<a name="line.687"></a>
<FONT color="green">688</FONT>                if ((subException != null) &amp;&amp; subException.isExceptionForFailure(propertyKey, failureKey))<a name="line.688"></a>
<FONT color="green">689</FONT>                {<a name="line.689"></a>
<FONT color="green">690</FONT>                    exceptionForFailure = subException;<a name="line.690"></a>
<FONT color="green">691</FONT>                    break;<a name="line.691"></a>
<FONT color="green">692</FONT>                }<a name="line.692"></a>
<FONT color="green">693</FONT>            }<a name="line.693"></a>
<FONT color="green">694</FONT>    <a name="line.694"></a>
<FONT color="green">695</FONT>            return exceptionForFailure;<a name="line.695"></a>
<FONT color="green">696</FONT>        }<a name="line.696"></a>
<FONT color="green">697</FONT>    <a name="line.697"></a>
<FONT color="green">698</FONT>    <a name="line.698"></a>
<FONT color="green">699</FONT>    <a name="line.699"></a>
<FONT color="green">700</FONT>        /**<a name="line.700"></a>
<FONT color="green">701</FONT>         * Returns &lt;code&gt;true&lt;/code&gt; if this exception, or any of the exceptions it contains equals the indicated type of validation failure on the named property.  This can be useful when implementing specific validation exception handling.  It determines this by checking to see if the parent exception or any of the additional exceptions return &lt;code&gt;true&lt;/code&gt; for &lt;code&gt;isExceptionForFailure()&lt;/code&gt;.<a name="line.701"></a>
<FONT color="green">702</FONT>         *<a name="line.702"></a>
<FONT color="green">703</FONT>         * @param propertyKey the name of the property to match for this failure.<a name="line.703"></a>
<FONT color="green">704</FONT>         * @param failureKey the type of validation failure.  See EOFValidation<a name="line.704"></a>
<FONT color="green">705</FONT>         * @return &lt;code&gt;true&lt;/code&gt; if this exception or any of it's additional exceptions equals the indicated type of validation failure on the named property<a name="line.705"></a>
<FONT color="green">706</FONT>         */<a name="line.706"></a>
<FONT color="green">707</FONT>        public boolean doesFailureExist(String propertyKey, String failureKey)<a name="line.707"></a>
<FONT color="green">708</FONT>        {<a name="line.708"></a>
<FONT color="green">709</FONT>            /** require<a name="line.709"></a>
<FONT color="green">710</FONT>            [valid_propertyKey_param] propertyKey != null;<a name="line.710"></a>
<FONT color="green">711</FONT>            [valid_failureKey_param] failureKey != null;<a name="line.711"></a>
<FONT color="green">712</FONT>            [failureKey_is_a_valid_key] EOFValidation.setOfAllFailureKeys.containsObject(failureKey); **/<a name="line.712"></a>
<FONT color="green">713</FONT>    <a name="line.713"></a>
<FONT color="green">714</FONT>            return findExceptionForFailure(propertyKey, failureKey) != null;<a name="line.714"></a>
<FONT color="green">715</FONT>        }<a name="line.715"></a>
<FONT color="green">716</FONT>    <a name="line.716"></a>
<FONT color="green">717</FONT>    <a name="line.717"></a>
<FONT color="green">718</FONT>    <a name="line.718"></a>
<FONT color="green">719</FONT>        /**<a name="line.719"></a>
<FONT color="green">720</FONT>         * Returns the exception for the indicated type of validation failure on the named property from either this exception, or any of its additional exceptions.  This can be useful when implementing specific validation exception handling.<a name="line.720"></a>
<FONT color="green">721</FONT>         *<a name="line.721"></a>
<FONT color="green">722</FONT>         * @param propertyKey the name of the property to match for this failure.<a name="line.722"></a>
<FONT color="green">723</FONT>         * @param failureKey the type of validation failure.  See EOFValidation and EOFValidationException.<a name="line.723"></a>
<FONT color="green">724</FONT>         * @return the exception for the indicated type of validation failure on the named property from either this exception, or any of the exceptions under it's AdditionalExceptionsKey.<a name="line.724"></a>
<FONT color="green">725</FONT>         */<a name="line.725"></a>
<FONT color="green">726</FONT>        public EOFValidationException exceptionForFailure(String propertyKey, String failureKey)<a name="line.726"></a>
<FONT color="green">727</FONT>        {<a name="line.727"></a>
<FONT color="green">728</FONT>            /** require<a name="line.728"></a>
<FONT color="green">729</FONT>            [valid_propertyKey_param] propertyKey != null;<a name="line.729"></a>
<FONT color="green">730</FONT>            [valid_failureKey_param] failureKey != null;<a name="line.730"></a>
<FONT color="green">731</FONT>            [failureKey_is_a_valid_key] EOFValidation.setOfAllFailureKeys.containsObject(failureKey);<a name="line.731"></a>
<FONT color="green">732</FONT>            [failure_exists] doesFailureExist(propertyKey, failureKey); **/<a name="line.732"></a>
<FONT color="green">733</FONT>    <a name="line.733"></a>
<FONT color="green">734</FONT>            return findExceptionForFailure(propertyKey, failureKey);<a name="line.734"></a>
<FONT color="green">735</FONT>    <a name="line.735"></a>
<FONT color="green">736</FONT>            /** ensure [valid_result] Result != null; **/<a name="line.736"></a>
<FONT color="green">737</FONT>        }<a name="line.737"></a>
<FONT color="green">738</FONT>    <a name="line.738"></a>
<FONT color="green">739</FONT>    <a name="line.739"></a>
<FONT color="green">740</FONT>    <a name="line.740"></a>
<FONT color="green">741</FONT>        /**<a name="line.741"></a>
<FONT color="green">742</FONT>         * Returns the optional exception that was translated into this EOFValidation exception.<a name="line.742"></a>
<FONT color="green">743</FONT>         *<a name="line.743"></a>
<FONT color="green">744</FONT>         * @return the optional exception that was translated into this EOFValidation exception<a name="line.744"></a>
<FONT color="green">745</FONT>         */<a name="line.745"></a>
<FONT color="green">746</FONT>        public Exception originalException()<a name="line.746"></a>
<FONT color="green">747</FONT>        {<a name="line.747"></a>
<FONT color="green">748</FONT>            return originalException;<a name="line.748"></a>
<FONT color="green">749</FONT>        }<a name="line.749"></a>
<FONT color="green">750</FONT>    <a name="line.750"></a>
<FONT color="green">751</FONT>    <a name="line.751"></a>
<FONT color="green">752</FONT>    <a name="line.752"></a>
<FONT color="green">753</FONT>        /**<a name="line.753"></a>
<FONT color="green">754</FONT>         * Sets the optional exception that was translated into this EOFValidation exception.<a name="line.754"></a>
<FONT color="green">755</FONT>         *<a name="line.755"></a>
<FONT color="green">756</FONT>         * @param anException the optional exception that was translated into this EOFValidation exception<a name="line.756"></a>
<FONT color="green">757</FONT>         */<a name="line.757"></a>
<FONT color="green">758</FONT>        public void setOriginalException(Exception anException)<a name="line.758"></a>
<FONT color="green">759</FONT>        {<a name="line.759"></a>
<FONT color="green">760</FONT>            originalException = anException;<a name="line.760"></a>
<FONT color="green">761</FONT>        }<a name="line.761"></a>
<FONT color="green">762</FONT>    <a name="line.762"></a>
<FONT color="green">763</FONT>    <a name="line.763"></a>
<FONT color="green">764</FONT>    <a name="line.764"></a>
<FONT color="green">765</FONT>    }<a name="line.765"></a>




























































</PRE>
</BODY>
</HTML>
