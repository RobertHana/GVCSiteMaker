<HTML>
<BODY BGCOLOR="white">
<PRE>
<FONT color="green">001</FONT>    package net.global_village.foundation;<a name="line.1"></a>
<FONT color="green">002</FONT>    <a name="line.2"></a>
<FONT color="green">003</FONT>    import java.io.FileInputStream;<a name="line.3"></a>
<FONT color="green">004</FONT>    import java.lang.reflect.*;<a name="line.4"></a>
<FONT color="green">005</FONT>    import java.util.*;<a name="line.5"></a>
<FONT color="green">006</FONT>    <a name="line.6"></a>
<FONT color="green">007</FONT>    import com.webobjects.foundation.*;<a name="line.7"></a>
<FONT color="green">008</FONT>    <a name="line.8"></a>
<FONT color="green">009</FONT>    <a name="line.9"></a>
<FONT color="green">010</FONT>    /**<a name="line.10"></a>
<FONT color="green">011</FONT>     * Collection utilities.<a name="line.11"></a>
<FONT color="green">012</FONT>     *<a name="line.12"></a>
<FONT color="green">013</FONT>     * @author Copyright (c) 2001-2005  Global Village Consulting, Inc.  All rights reserved.<a name="line.13"></a>
<FONT color="green">014</FONT>     * This software is published under the terms of the Educational Community License (ECL) version 1.0,<a name="line.14"></a>
<FONT color="green">015</FONT>     * a copy of which has been included with this distribution in the LICENSE.TXT file.<a name="line.15"></a>
<FONT color="green">016</FONT>     * @version $Revision: 10$<a name="line.16"></a>
<FONT color="green">017</FONT>     */<a name="line.17"></a>
<FONT color="green">018</FONT>    public class Collection<a name="line.18"></a>
<FONT color="green">019</FONT>    {<a name="line.19"></a>
<FONT color="green">020</FONT>    <a name="line.20"></a>
<FONT color="green">021</FONT>    <a name="line.21"></a>
<FONT color="green">022</FONT>        /**<a name="line.22"></a>
<FONT color="green">023</FONT>         * Static methods only.  You'll never need to instantiate this class.<a name="line.23"></a>
<FONT color="green">024</FONT>         */<a name="line.24"></a>
<FONT color="green">025</FONT>        private Collection()<a name="line.25"></a>
<FONT color="green">026</FONT>        {<a name="line.26"></a>
<FONT color="green">027</FONT>            super();<a name="line.27"></a>
<FONT color="green">028</FONT>        }<a name="line.28"></a>
<FONT color="green">029</FONT>    <a name="line.29"></a>
<FONT color="green">030</FONT>    <a name="line.30"></a>
<FONT color="green">031</FONT>    <a name="line.31"></a>
<FONT color="green">032</FONT>        /**<a name="line.32"></a>
<FONT color="green">033</FONT>         * Converts a java array (including its contents) to a string useful for debugging. The format is unspecified, so don't expect anything specific out of here.<a name="line.33"></a>
<FONT color="green">034</FONT>         *<a name="line.34"></a>
<FONT color="green">035</FONT>         * @param array the array to print<a name="line.35"></a>
<FONT color="green">036</FONT>         * @return a string representation of the java array<a name="line.36"></a>
<FONT color="green">037</FONT>         */<a name="line.37"></a>
<FONT color="green">038</FONT>        public static String javaArrayToString(Object[] array)<a name="line.38"></a>
<FONT color="green">039</FONT>        {<a name="line.39"></a>
<FONT color="green">040</FONT>            /** require [valid_param] array != null; **/<a name="line.40"></a>
<FONT color="green">041</FONT>    <a name="line.41"></a>
<FONT color="green">042</FONT>            String javaArrayToString = "";<a name="line.42"></a>
<FONT color="green">043</FONT>    <a name="line.43"></a>
<FONT color="green">044</FONT>            for (int i = 0; i &lt; array.length; i++)<a name="line.44"></a>
<FONT color="green">045</FONT>            {<a name="line.45"></a>
<FONT color="green">046</FONT>                javaArrayToString = javaArrayToString + array[i].toString() + "\n";<a name="line.46"></a>
<FONT color="green">047</FONT>            }<a name="line.47"></a>
<FONT color="green">048</FONT>    <a name="line.48"></a>
<FONT color="green">049</FONT>            return javaArrayToString;<a name="line.49"></a>
<FONT color="green">050</FONT>    <a name="line.50"></a>
<FONT color="green">051</FONT>            /** ensure [valid_result] Result != null; **/<a name="line.51"></a>
<FONT color="green">052</FONT>        }<a name="line.52"></a>
<FONT color="green">053</FONT>    <a name="line.53"></a>
<FONT color="green">054</FONT>    <a name="line.54"></a>
<FONT color="green">055</FONT>    <a name="line.55"></a>
<FONT color="green">056</FONT>        /**<a name="line.56"></a>
<FONT color="green">057</FONT>         * Returns &lt;code&gt;true&lt;/code&gt; iff the given object is a collection type, as defined by this class (other objects may strictly be collections, but only the shown ones here are useful for this class), &lt;code&gt;false&lt;/code&gt; otherwise.<a name="line.57"></a>
<FONT color="green">058</FONT>         *<a name="line.58"></a>
<FONT color="green">059</FONT>         * @param collection the object to test<a name="line.59"></a>
<FONT color="green">060</FONT>         * @return &lt;code&gt;true&lt;/code&gt; iff the given object is a collection type, &lt;code&gt;false&lt;/code&gt; otherwise<a name="line.60"></a>
<FONT color="green">061</FONT>         */<a name="line.61"></a>
<FONT color="green">062</FONT>        public static boolean isCollection(Object collection)<a name="line.62"></a>
<FONT color="green">063</FONT>        {<a name="line.63"></a>
<FONT color="green">064</FONT>            /** require [valid_param] collection != null; **/<a name="line.64"></a>
<FONT color="green">065</FONT>    <a name="line.65"></a>
<FONT color="green">066</FONT>            return NSSet.class.isInstance(collection) || NSArray.class.isInstance(collection) || NSDictionary.class.isInstance(collection) || java.util.Collection.class.isInstance(collection) || Dictionary.class.isInstance(collection);<a name="line.66"></a>
<FONT color="green">067</FONT>        }<a name="line.67"></a>
<FONT color="green">068</FONT>    <a name="line.68"></a>
<FONT color="green">069</FONT>    <a name="line.69"></a>
<FONT color="green">070</FONT>    <a name="line.70"></a>
<FONT color="green">071</FONT>        /**<a name="line.71"></a>
<FONT color="green">072</FONT>         * Point of single choice for abstracting away the differences in enumerations in the various collections.  Returns an &lt;code&gt;Enumeration&lt;/code&gt; object for the given collection.<a name="line.72"></a>
<FONT color="green">073</FONT>         *<a name="line.73"></a>
<FONT color="green">074</FONT>         * @param collection the collection to return the enumeration for<a name="line.74"></a>
<FONT color="green">075</FONT>         * @return the &lt;code&gt;Enumeration&lt;/code&gt; for the given collection<a name="line.75"></a>
<FONT color="green">076</FONT>         */<a name="line.76"></a>
<FONT color="green">077</FONT>        public static Enumeration enumerationForCollection(Object collection)<a name="line.77"></a>
<FONT color="green">078</FONT>        {<a name="line.78"></a>
<FONT color="green">079</FONT>            /** require [valid_param] collection != null; [is_collection] isCollection(collection); **/<a name="line.79"></a>
<FONT color="green">080</FONT>    <a name="line.80"></a>
<FONT color="green">081</FONT>            Enumeration enumerationForCollection = null;<a name="line.81"></a>
<FONT color="green">082</FONT>    <a name="line.82"></a>
<FONT color="green">083</FONT>            if (NSSet.class.isInstance(collection) || NSArray.class.isInstance(collection) || NSDictionary.class.isInstance(collection))<a name="line.83"></a>
<FONT color="green">084</FONT>            {<a name="line.84"></a>
<FONT color="green">085</FONT>                NSSelector countSelector = new NSSelector("count");<a name="line.85"></a>
<FONT color="green">086</FONT>                NSSelector enumeratorSelector = new NSSelector("objectEnumerator");<a name="line.86"></a>
<FONT color="green">087</FONT>                try<a name="line.87"></a>
<FONT color="green">088</FONT>                {<a name="line.88"></a>
<FONT color="green">089</FONT>                    // Apparently you can't call objectEnumerator on an empty array<a name="line.89"></a>
<FONT color="green">090</FONT>                    if (((Number)countSelector.invoke(collection)).intValue() &gt; 0)<a name="line.90"></a>
<FONT color="green">091</FONT>                    {<a name="line.91"></a>
<FONT color="green">092</FONT>                        enumerationForCollection = (Enumeration)enumeratorSelector.invoke(collection);<a name="line.92"></a>
<FONT color="green">093</FONT>                    }<a name="line.93"></a>
<FONT color="green">094</FONT>                    else<a name="line.94"></a>
<FONT color="green">095</FONT>                    {<a name="line.95"></a>
<FONT color="green">096</FONT>                        // So return an empty linked list one<a name="line.96"></a>
<FONT color="green">097</FONT>                        enumerationForCollection = Collection.enumerationForCollection(new LinkedList());<a name="line.97"></a>
<FONT color="green">098</FONT>                    }<a name="line.98"></a>
<FONT color="green">099</FONT>                }<a name="line.99"></a>
<FONT color="green">100</FONT>                // These should never happen...<a name="line.100"></a>
<FONT color="green">101</FONT>                catch (NoSuchMethodException e) { throw new ExceptionConverter(e); }<a name="line.101"></a>
<FONT color="green">102</FONT>                catch (java.lang.reflect.InvocationTargetException e) { throw new ExceptionConverter(e); }<a name="line.102"></a>
<FONT color="green">103</FONT>                catch (IllegalAccessException e) { throw new ExceptionConverter(e); }<a name="line.103"></a>
<FONT color="green">104</FONT>                catch (IllegalArgumentException e) { throw new ExceptionConverter(e); }<a name="line.104"></a>
<FONT color="green">105</FONT>            }<a name="line.105"></a>
<FONT color="green">106</FONT>            else if (Dictionary.class.isInstance(collection))<a name="line.106"></a>
<FONT color="green">107</FONT>            {<a name="line.107"></a>
<FONT color="green">108</FONT>                NSSelector sel = new NSSelector("elements");<a name="line.108"></a>
<FONT color="green">109</FONT>                try<a name="line.109"></a>
<FONT color="green">110</FONT>                {<a name="line.110"></a>
<FONT color="green">111</FONT>                    enumerationForCollection = (Enumeration)sel.invoke(collection);<a name="line.111"></a>
<FONT color="green">112</FONT>                }<a name="line.112"></a>
<FONT color="green">113</FONT>                // These should never happen...<a name="line.113"></a>
<FONT color="green">114</FONT>                catch (NoSuchMethodException e) { throw new ExceptionConverter(e); }<a name="line.114"></a>
<FONT color="green">115</FONT>                catch (java.lang.reflect.InvocationTargetException e) { throw new ExceptionConverter(e); }<a name="line.115"></a>
<FONT color="green">116</FONT>                catch (IllegalAccessException e) { throw new ExceptionConverter(e); }<a name="line.116"></a>
<FONT color="green">117</FONT>                catch (IllegalArgumentException e) { throw new ExceptionConverter(e); }<a name="line.117"></a>
<FONT color="green">118</FONT>            }<a name="line.118"></a>
<FONT color="green">119</FONT>            else<a name="line.119"></a>
<FONT color="green">120</FONT>            {<a name="line.120"></a>
<FONT color="green">121</FONT>                enumerationForCollection = Collections.enumeration((java.util.Collection)collection);<a name="line.121"></a>
<FONT color="green">122</FONT>            }<a name="line.122"></a>
<FONT color="green">123</FONT>    <a name="line.123"></a>
<FONT color="green">124</FONT>            return enumerationForCollection;<a name="line.124"></a>
<FONT color="green">125</FONT>    <a name="line.125"></a>
<FONT color="green">126</FONT>            /** ensure [valid_result] Result != null; **/<a name="line.126"></a>
<FONT color="green">127</FONT>        }<a name="line.127"></a>
<FONT color="green">128</FONT>    <a name="line.128"></a>
<FONT color="green">129</FONT>    <a name="line.129"></a>
<FONT color="green">130</FONT>    <a name="line.130"></a>
<FONT color="green">131</FONT>        /**<a name="line.131"></a>
<FONT color="green">132</FONT>         * Given an arbitrary collection, returns an &lt;code&gt;NSMutableArray&lt;/code&gt; with the same objects.<a name="line.132"></a>
<FONT color="green">133</FONT>         *<a name="line.133"></a>
<FONT color="green">134</FONT>         * @param collection the collection to change<a name="line.134"></a>
<FONT color="green">135</FONT>         * @return an &lt;code&gt;NSMutableArray&lt;/code&gt; filled with the same objects as in &lt;code&gt;collection&lt;/code&gt;<a name="line.135"></a>
<FONT color="green">136</FONT>         */<a name="line.136"></a>
<FONT color="green">137</FONT>        public static NSMutableArray collectionToNSMutableArray(Object collection)<a name="line.137"></a>
<FONT color="green">138</FONT>        {<a name="line.138"></a>
<FONT color="green">139</FONT>            /** require [valid_param] collection != null; [is_collection] isCollection(collection); **/<a name="line.139"></a>
<FONT color="green">140</FONT>    <a name="line.140"></a>
<FONT color="green">141</FONT>            NSMutableArray theArray = new NSMutableArray();<a name="line.141"></a>
<FONT color="green">142</FONT>            Enumeration collectionEnumerator = enumerationForCollection(collection);<a name="line.142"></a>
<FONT color="green">143</FONT>            while (collectionEnumerator.hasMoreElements())<a name="line.143"></a>
<FONT color="green">144</FONT>            {<a name="line.144"></a>
<FONT color="green">145</FONT>                Object theElement = collectionEnumerator.nextElement();<a name="line.145"></a>
<FONT color="green">146</FONT>                theArray.addObject(theElement);<a name="line.146"></a>
<FONT color="green">147</FONT>            }<a name="line.147"></a>
<FONT color="green">148</FONT>            return theArray;<a name="line.148"></a>
<FONT color="green">149</FONT>    <a name="line.149"></a>
<FONT color="green">150</FONT>            /** ensure [valid_result] Result != null; **/<a name="line.150"></a>
<FONT color="green">151</FONT>        }<a name="line.151"></a>
<FONT color="green">152</FONT>    <a name="line.152"></a>
<FONT color="green">153</FONT>    <a name="line.153"></a>
<FONT color="green">154</FONT>    <a name="line.154"></a>
<FONT color="green">155</FONT>        /**<a name="line.155"></a>
<FONT color="green">156</FONT>         * Given an arbitrary collection, returns an &lt;code&gt;NSMutableSet&lt;/code&gt; with the same objects. If &lt;code&gt;collection&lt;/code&gt; contains duplicate objects, only one of the objects will be included in the set, as per normal set semantics.<a name="line.156"></a>
<FONT color="green">157</FONT>         *<a name="line.157"></a>
<FONT color="green">158</FONT>         * @param collection the collection to change<a name="line.158"></a>
<FONT color="green">159</FONT>         * @return an &lt;code&gt;NSMutableSet&lt;/code&gt; filled with the same objects as in &lt;code&gt;collection&lt;/code&gt;<a name="line.159"></a>
<FONT color="green">160</FONT>         */<a name="line.160"></a>
<FONT color="green">161</FONT>        public static NSMutableSet collectionToNSMutableSet(Object collection)<a name="line.161"></a>
<FONT color="green">162</FONT>        {<a name="line.162"></a>
<FONT color="green">163</FONT>            /** require [valid_param] collection != null; [is_collection] isCollection(collection); **/<a name="line.163"></a>
<FONT color="green">164</FONT>    <a name="line.164"></a>
<FONT color="green">165</FONT>            NSMutableSet theSet = new NSMutableSet();<a name="line.165"></a>
<FONT color="green">166</FONT>            Enumeration collectionEnumerator = enumerationForCollection(collection);<a name="line.166"></a>
<FONT color="green">167</FONT>            while (collectionEnumerator.hasMoreElements())<a name="line.167"></a>
<FONT color="green">168</FONT>            {<a name="line.168"></a>
<FONT color="green">169</FONT>                Object theElement = collectionEnumerator.nextElement();<a name="line.169"></a>
<FONT color="green">170</FONT>                theSet.addObject(theElement);<a name="line.170"></a>
<FONT color="green">171</FONT>            }<a name="line.171"></a>
<FONT color="green">172</FONT>            return theSet;<a name="line.172"></a>
<FONT color="green">173</FONT>    <a name="line.173"></a>
<FONT color="green">174</FONT>            /** ensure [valid_result] Result != null; **/<a name="line.174"></a>
<FONT color="green">175</FONT>        }<a name="line.175"></a>
<FONT color="green">176</FONT>    <a name="line.176"></a>
<FONT color="green">177</FONT>    <a name="line.177"></a>
<FONT color="green">178</FONT>    <a name="line.178"></a>
<FONT color="green">179</FONT>        /**<a name="line.179"></a>
<FONT color="green">180</FONT>         * Returns an &lt;code&gt;NSArray&lt;/code&gt; or an &lt;code&gt;NSDictionary&lt;/code&gt; created from the contents of &lt;code&gt;filePath&lt;/code&gt;.<a name="line.180"></a>
<FONT color="green">181</FONT>         *<a name="line.181"></a>
<FONT color="green">182</FONT>         * @param filePath the path to the file<a name="line.182"></a>
<FONT color="green">183</FONT>         * @return an array or dictionary<a name="line.183"></a>
<FONT color="green">184</FONT>         */<a name="line.184"></a>
<FONT color="green">185</FONT>        public static Object collectionWithContentsOfFile(String filePath) throws java.io.IOException<a name="line.185"></a>
<FONT color="green">186</FONT>        {<a name="line.186"></a>
<FONT color="green">187</FONT>            /** require [valid_param] filePath != null; **/<a name="line.187"></a>
<FONT color="green">188</FONT>    <a name="line.188"></a>
<FONT color="green">189</FONT>            FileInputStream fis = new FileInputStream(filePath);<a name="line.189"></a>
<FONT color="green">190</FONT>            NSData aData = new NSData(fis, 1000);<a name="line.190"></a>
<FONT color="green">191</FONT>            return NSPropertyListSerialization.propertyListFromData(aData, "ASCII");<a name="line.191"></a>
<FONT color="green">192</FONT>    <a name="line.192"></a>
<FONT color="green">193</FONT>            /** ensure<a name="line.193"></a>
<FONT color="green">194</FONT>            [valid_result] Result != null;<a name="line.194"></a>
<FONT color="green">195</FONT>            [is_collection_class] (Result instanceof NSArray) || (Result instanceof NSDictionary); **/<a name="line.195"></a>
<FONT color="green">196</FONT>        }<a name="line.196"></a>
<FONT color="green">197</FONT>    <a name="line.197"></a>
<FONT color="green">198</FONT>    <a name="line.198"></a>
<FONT color="green">199</FONT>    <a name="line.199"></a>
<FONT color="green">200</FONT>        /**<a name="line.200"></a>
<FONT color="green">201</FONT>         * Tells if a given collection contains all objects of type instanceOf (as given by Class.isInstance()).<a name="line.201"></a>
<FONT color="green">202</FONT>         *<a name="line.202"></a>
<FONT color="green">203</FONT>         * @param collection the collection to check<a name="line.203"></a>
<FONT color="green">204</FONT>         * @param instancesOf the class that the collection should contain<a name="line.204"></a>
<FONT color="green">205</FONT>         * @return &lt;code&gt;true&lt;/code&gt; iff all objects in the collection are of type &lt;code&gt;instancesOf&lt;/code&gt;, &lt;code&gt;false&lt;/code&gt; otherwise<a name="line.205"></a>
<FONT color="green">206</FONT>         */<a name="line.206"></a>
<FONT color="green">207</FONT>        public static boolean collectionContainsInstancesOf(Object collection, java.lang.Class instancesOf)<a name="line.207"></a>
<FONT color="green">208</FONT>        {<a name="line.208"></a>
<FONT color="green">209</FONT>            /** require<a name="line.209"></a>
<FONT color="green">210</FONT>            [valid_collection_param] collection != null;<a name="line.210"></a>
<FONT color="green">211</FONT>            [valid_instancesOf_param] instancesOf != null;<a name="line.211"></a>
<FONT color="green">212</FONT>            [is_collection] isCollection(collection); **/<a name="line.212"></a>
<FONT color="green">213</FONT>    <a name="line.213"></a>
<FONT color="green">214</FONT>            boolean collectionContainsInstancesOf = true;<a name="line.214"></a>
<FONT color="green">215</FONT>            Enumeration collectionEnumerator = enumerationForCollection(collection);<a name="line.215"></a>
<FONT color="green">216</FONT>            while (collectionEnumerator.hasMoreElements())<a name="line.216"></a>
<FONT color="green">217</FONT>            {<a name="line.217"></a>
<FONT color="green">218</FONT>                Object theElement = collectionEnumerator.nextElement();<a name="line.218"></a>
<FONT color="green">219</FONT>                if ( ! instancesOf.isInstance(theElement))<a name="line.219"></a>
<FONT color="green">220</FONT>                {<a name="line.220"></a>
<FONT color="green">221</FONT>                    collectionContainsInstancesOf = false;<a name="line.221"></a>
<FONT color="green">222</FONT>                    break;<a name="line.222"></a>
<FONT color="green">223</FONT>                }<a name="line.223"></a>
<FONT color="green">224</FONT>            }<a name="line.224"></a>
<FONT color="green">225</FONT>            return collectionContainsInstancesOf;<a name="line.225"></a>
<FONT color="green">226</FONT>        }<a name="line.226"></a>
<FONT color="green">227</FONT>    <a name="line.227"></a>
<FONT color="green">228</FONT>    <a name="line.228"></a>
<FONT color="green">229</FONT>    <a name="line.229"></a>
<FONT color="green">230</FONT>        /**<a name="line.230"></a>
<FONT color="green">231</FONT>         * Tells if the given collection contains objects that all respond to &lt;code&gt;selector&lt;/code&gt;.<a name="line.231"></a>
<FONT color="green">232</FONT>         *<a name="line.232"></a>
<FONT color="green">233</FONT>         * @param collection the collection to check<a name="line.233"></a>
<FONT color="green">234</FONT>         * @param selector the selector that each object should respond to<a name="line.234"></a>
<FONT color="green">235</FONT>         * @return &lt;code&gt;true&lt;/code&gt; iff all objects in the collection respond to &lt;code&gt;selector&lt;/code&gt;, &lt;code&gt;false&lt;/code&gt; otherwise<a name="line.235"></a>
<FONT color="green">236</FONT>         */<a name="line.236"></a>
<FONT color="green">237</FONT>        public static boolean collectionContainsInstancesRespondingTo(Object collection, NSSelector selector)<a name="line.237"></a>
<FONT color="green">238</FONT>        {<a name="line.238"></a>
<FONT color="green">239</FONT>            /** require<a name="line.239"></a>
<FONT color="green">240</FONT>            [valid_collection_param] collection != null;<a name="line.240"></a>
<FONT color="green">241</FONT>            [valid_selector_param] selector != null;<a name="line.241"></a>
<FONT color="green">242</FONT>            [is_collection] isCollection(collection); **/<a name="line.242"></a>
<FONT color="green">243</FONT>    <a name="line.243"></a>
<FONT color="green">244</FONT>            boolean collectionContainsInstancesRespondingTo = true;<a name="line.244"></a>
<FONT color="green">245</FONT>            Enumeration collectionEnumerator = enumerationForCollection(collection);<a name="line.245"></a>
<FONT color="green">246</FONT>            while (collectionEnumerator.hasMoreElements())<a name="line.246"></a>
<FONT color="green">247</FONT>            {<a name="line.247"></a>
<FONT color="green">248</FONT>                Object theElement = collectionEnumerator.nextElement();<a name="line.248"></a>
<FONT color="green">249</FONT>                if ( ! selector.implementedByObject(theElement))<a name="line.249"></a>
<FONT color="green">250</FONT>                {<a name="line.250"></a>
<FONT color="green">251</FONT>                    collectionContainsInstancesRespondingTo = false;<a name="line.251"></a>
<FONT color="green">252</FONT>                    break;<a name="line.252"></a>
<FONT color="green">253</FONT>                }<a name="line.253"></a>
<FONT color="green">254</FONT>            }<a name="line.254"></a>
<FONT color="green">255</FONT>            return collectionContainsInstancesRespondingTo;<a name="line.255"></a>
<FONT color="green">256</FONT>        }<a name="line.256"></a>
<FONT color="green">257</FONT>    <a name="line.257"></a>
<FONT color="green">258</FONT>    <a name="line.258"></a>
<FONT color="green">259</FONT>    <a name="line.259"></a>
<FONT color="green">260</FONT>        /**<a name="line.260"></a>
<FONT color="green">261</FONT>         * Invokes &lt;code&gt;toSelector&lt;/code&gt; with &lt;code&gt;arguments&lt;/code&gt; on the elements of &lt;code&gt;collection&lt;/code&gt; to see if any return &lt;code&gt;response&lt;/code&gt;.  The method is &lt;em&gt;not&lt;/em&gt; guaranteed to be called on all elements of the collection.<a name="line.261"></a>
<FONT color="green">262</FONT>         *<a name="line.262"></a>
<FONT color="green">263</FONT>         * @param collection the collection to check<a name="line.263"></a>
<FONT color="green">264</FONT>         * @param response the expected response from the collection<a name="line.264"></a>
<FONT color="green">265</FONT>         * @param toSelector the selector to invoke<a name="line.265"></a>
<FONT color="green">266</FONT>         * @param arguments the arguments to send to the method<a name="line.266"></a>
<FONT color="green">267</FONT>         * @return &lt;code&gt;true&lt;/code&gt; iff any objects in the collection return &lt;code&gt;response&lt;/code&gt;, &lt;code&gt;false&lt;/code&gt; otherwise<a name="line.267"></a>
<FONT color="green">268</FONT>         * @exception java.lang.reflect.InvocationTargetException thrown when the method called by the selector itself raises an exception<a name="line.268"></a>
<FONT color="green">269</FONT>         * @exception IllegalAccessException thrown when the method called by the selector cannot be reached from this<a name="line.269"></a>
<FONT color="green">270</FONT>         */<a name="line.270"></a>
<FONT color="green">271</FONT>        public static boolean doAnyObjectsRespond(Object collection,<a name="line.271"></a>
<FONT color="green">272</FONT>                                                  Object response,<a name="line.272"></a>
<FONT color="green">273</FONT>                                                  NSSelector toSelector,<a name="line.273"></a>
<FONT color="green">274</FONT>                                                  Object[] arguments) throws java.lang.reflect.InvocationTargetException, IllegalAccessException<a name="line.274"></a>
<FONT color="green">275</FONT>        {<a name="line.275"></a>
<FONT color="green">276</FONT>            /** require<a name="line.276"></a>
<FONT color="green">277</FONT>            [valid_collection_param] collection != null;<a name="line.277"></a>
<FONT color="green">278</FONT>            [valid_response_param] response != null;<a name="line.278"></a>
<FONT color="green">279</FONT>            [valid_toSelector_param] toSelector != null;<a name="line.279"></a>
<FONT color="green">280</FONT>            [is_collection] isCollection(collection);<a name="line.280"></a>
<FONT color="green">281</FONT>            [collection_items_respond_to_selector] collectionContainsInstancesRespondingTo(collection, toSelector); **/<a name="line.281"></a>
<FONT color="green">282</FONT>    <a name="line.282"></a>
<FONT color="green">283</FONT>            boolean doAnyObjectsRespond = false;<a name="line.283"></a>
<FONT color="green">284</FONT>            Enumeration collectionEnumerator = enumerationForCollection(collection);<a name="line.284"></a>
<FONT color="green">285</FONT>            while (collectionEnumerator.hasMoreElements())<a name="line.285"></a>
<FONT color="green">286</FONT>            {<a name="line.286"></a>
<FONT color="green">287</FONT>                try<a name="line.287"></a>
<FONT color="green">288</FONT>                {<a name="line.288"></a>
<FONT color="green">289</FONT>                    Object theElement = collectionEnumerator.nextElement();<a name="line.289"></a>
<FONT color="green">290</FONT>                    Object result = toSelector.invoke(theElement, arguments);<a name="line.290"></a>
<FONT color="green">291</FONT>                    if (result.equals(response))<a name="line.291"></a>
<FONT color="green">292</FONT>                    {<a name="line.292"></a>
<FONT color="green">293</FONT>                        doAnyObjectsRespond = true;<a name="line.293"></a>
<FONT color="green">294</FONT>                        break;<a name="line.294"></a>
<FONT color="green">295</FONT>                    }<a name="line.295"></a>
<FONT color="green">296</FONT>                }<a name="line.296"></a>
<FONT color="green">297</FONT>                catch (NoSuchMethodException e) { throw new Error(e); }<a name="line.297"></a>
<FONT color="green">298</FONT>            }<a name="line.298"></a>
<FONT color="green">299</FONT>            return doAnyObjectsRespond;<a name="line.299"></a>
<FONT color="green">300</FONT>        }<a name="line.300"></a>
<FONT color="green">301</FONT>    <a name="line.301"></a>
<FONT color="green">302</FONT>    <a name="line.302"></a>
<FONT color="green">303</FONT>    <a name="line.303"></a>
<FONT color="green">304</FONT>        /**<a name="line.304"></a>
<FONT color="green">305</FONT>         * Invokes &lt;code&gt;toSelector&lt;/code&gt; with &lt;code&gt;arguments&lt;/code&gt; on the elements of &lt;code&gt;collection&lt;/code&gt; to see if all return &lt;code&gt;response&lt;/code&gt;.  The method is &lt;em&gt;not&lt;/em&gt; guaranteed to be called on all elements of the collection.<a name="line.305"></a>
<FONT color="green">306</FONT>         *<a name="line.306"></a>
<FONT color="green">307</FONT>         * @param collection the collection to check<a name="line.307"></a>
<FONT color="green">308</FONT>         * @param response the expected response from the collection<a name="line.308"></a>
<FONT color="green">309</FONT>         * @param toSelector the selector to invoke<a name="line.309"></a>
<FONT color="green">310</FONT>         * @param arguments the arguments to send to the method<a name="line.310"></a>
<FONT color="green">311</FONT>         * @return &lt;code&gt;true&lt;/code&gt; iff all objects in the collection return &lt;code&gt;response&lt;/code&gt;, &lt;code&gt;false&lt;/code&gt; otherwise<a name="line.311"></a>
<FONT color="green">312</FONT>         * @exception java.lang.reflect.InvocationTargetException thrown when the method called by the selector itself raises an exception<a name="line.312"></a>
<FONT color="green">313</FONT>         * @exception IllegalAccessException thrown when the method called by the selector cannot be reached from this<a name="line.313"></a>
<FONT color="green">314</FONT>         */<a name="line.314"></a>
<FONT color="green">315</FONT>        public static boolean doAllObjectsRespond(Object collection,<a name="line.315"></a>
<FONT color="green">316</FONT>                                                  Object response,<a name="line.316"></a>
<FONT color="green">317</FONT>                                                  NSSelector toSelector,<a name="line.317"></a>
<FONT color="green">318</FONT>                                                  Object[] arguments) throws java.lang.reflect.InvocationTargetException, IllegalAccessException<a name="line.318"></a>
<FONT color="green">319</FONT>        {<a name="line.319"></a>
<FONT color="green">320</FONT>            /** require<a name="line.320"></a>
<FONT color="green">321</FONT>            [valid_collection_param] collection != null;<a name="line.321"></a>
<FONT color="green">322</FONT>            [valid_response_param] response != null;<a name="line.322"></a>
<FONT color="green">323</FONT>            [valid_toSelector_param] toSelector != null;<a name="line.323"></a>
<FONT color="green">324</FONT>            [is_collection] isCollection(collection);<a name="line.324"></a>
<FONT color="green">325</FONT>            [collection_items_respond_to_selector] collectionContainsInstancesRespondingTo(collection, toSelector); **/<a name="line.325"></a>
<FONT color="green">326</FONT>    <a name="line.326"></a>
<FONT color="green">327</FONT>            boolean doAllObjectsRespond = true;<a name="line.327"></a>
<FONT color="green">328</FONT>            Enumeration collectionEnumerator = enumerationForCollection(collection);<a name="line.328"></a>
<FONT color="green">329</FONT>            while (collectionEnumerator.hasMoreElements())<a name="line.329"></a>
<FONT color="green">330</FONT>            {<a name="line.330"></a>
<FONT color="green">331</FONT>                try<a name="line.331"></a>
<FONT color="green">332</FONT>                {<a name="line.332"></a>
<FONT color="green">333</FONT>                    Object theElement = collectionEnumerator.nextElement();<a name="line.333"></a>
<FONT color="green">334</FONT>                    Object result = toSelector.invoke(theElement, arguments);<a name="line.334"></a>
<FONT color="green">335</FONT>                    if ( ! result.equals(response))<a name="line.335"></a>
<FONT color="green">336</FONT>                    {<a name="line.336"></a>
<FONT color="green">337</FONT>                        doAllObjectsRespond = false;<a name="line.337"></a>
<FONT color="green">338</FONT>                        break;<a name="line.338"></a>
<FONT color="green">339</FONT>                    }<a name="line.339"></a>
<FONT color="green">340</FONT>                }<a name="line.340"></a>
<FONT color="green">341</FONT>                catch (NoSuchMethodException e) { }<a name="line.341"></a>
<FONT color="green">342</FONT>            }<a name="line.342"></a>
<FONT color="green">343</FONT>            return doAllObjectsRespond;<a name="line.343"></a>
<FONT color="green">344</FONT>        }<a name="line.344"></a>
<FONT color="green">345</FONT>    <a name="line.345"></a>
<FONT color="green">346</FONT>    <a name="line.346"></a>
<FONT color="green">347</FONT>    <a name="line.347"></a>
<FONT color="green">348</FONT>        /**<a name="line.348"></a>
<FONT color="green">349</FONT>         * Returns those objects that respond to &lt;code&gt;toSelector&lt;/code&gt;.<a name="line.349"></a>
<FONT color="green">350</FONT>         *<a name="line.350"></a>
<FONT color="green">351</FONT>         * @param collection the collection to check<a name="line.351"></a>
<FONT color="green">352</FONT>         * @param toSelector the selector to test<a name="line.352"></a>
<FONT color="green">353</FONT>         * @return any objects in the collection that responde to &lt;code&gt;toSelector&lt;/code&gt;<a name="line.353"></a>
<FONT color="green">354</FONT>         */<a name="line.354"></a>
<FONT color="green">355</FONT>        public static NSArray objectsRespondingTo(Object collection,<a name="line.355"></a>
<FONT color="green">356</FONT>                                                  NSSelector toSelector)<a name="line.356"></a>
<FONT color="green">357</FONT>        {<a name="line.357"></a>
<FONT color="green">358</FONT>            /** require<a name="line.358"></a>
<FONT color="green">359</FONT>            [valid_collection_param] collection != null;<a name="line.359"></a>
<FONT color="green">360</FONT>            [valid_toSelector_param] toSelector != null;<a name="line.360"></a>
<FONT color="green">361</FONT>            [is_collection] isCollection(collection); **/<a name="line.361"></a>
<FONT color="green">362</FONT>    <a name="line.362"></a>
<FONT color="green">363</FONT>            NSMutableArray objectsRespondingTo = new NSMutableArray();<a name="line.363"></a>
<FONT color="green">364</FONT>            Enumeration collectionEnumerator = enumerationForCollection(collection);<a name="line.364"></a>
<FONT color="green">365</FONT>            while (collectionEnumerator.hasMoreElements())<a name="line.365"></a>
<FONT color="green">366</FONT>            {<a name="line.366"></a>
<FONT color="green">367</FONT>                Object theElement = collectionEnumerator.nextElement();<a name="line.367"></a>
<FONT color="green">368</FONT>                if (toSelector.implementedByObject(theElement))<a name="line.368"></a>
<FONT color="green">369</FONT>                {<a name="line.369"></a>
<FONT color="green">370</FONT>                    objectsRespondingTo.addObject(theElement);<a name="line.370"></a>
<FONT color="green">371</FONT>                }<a name="line.371"></a>
<FONT color="green">372</FONT>            }<a name="line.372"></a>
<FONT color="green">373</FONT>            return objectsRespondingTo;<a name="line.373"></a>
<FONT color="green">374</FONT>    <a name="line.374"></a>
<FONT color="green">375</FONT>            /** ensure [valid_result] Result != null; **/<a name="line.375"></a>
<FONT color="green">376</FONT>        }<a name="line.376"></a>
<FONT color="green">377</FONT>    <a name="line.377"></a>
<FONT color="green">378</FONT>    <a name="line.378"></a>
<FONT color="green">379</FONT>    <a name="line.379"></a>
<FONT color="green">380</FONT>        /**<a name="line.380"></a>
<FONT color="green">381</FONT>         * Invokes &lt;code&gt;toSelector&lt;/code&gt; with &lt;code&gt;arguments&lt;/code&gt; on the elements of &lt;code&gt;collection&lt;/code&gt;.  All items in the collection that return &lt;code&gt;response&lt;/code&gt; (as determined by &lt;code&gt;equals()&lt;/code&gt;) are returned.<a name="line.381"></a>
<FONT color="green">382</FONT>         *<a name="line.382"></a>
<FONT color="green">383</FONT>         * @param collection the collection to check<a name="line.383"></a>
<FONT color="green">384</FONT>         * @param response the expected response from the collection<a name="line.384"></a>
<FONT color="green">385</FONT>         * @param toSelector the selector to invoke<a name="line.385"></a>
<FONT color="green">386</FONT>         * @param arguments the arguments to send to the method<a name="line.386"></a>
<FONT color="green">387</FONT>         * @return any objects in the collection that returned &lt;code&gt;response&lt;/code&gt;<a name="line.387"></a>
<FONT color="green">388</FONT>         * @exception java.lang.reflect.InvocationTargetException thrown when the method called by the selector itself raises an exception<a name="line.388"></a>
<FONT color="green">389</FONT>         * @exception IllegalAccessException thrown when the method called by the selector cannot be reached from this<a name="line.389"></a>
<FONT color="green">390</FONT>         */<a name="line.390"></a>
<FONT color="green">391</FONT>        public static NSArray objectsResponding(Object collection,<a name="line.391"></a>
<FONT color="green">392</FONT>                                                Object response,<a name="line.392"></a>
<FONT color="green">393</FONT>                                                NSSelector toSelector,<a name="line.393"></a>
<FONT color="green">394</FONT>                                                Object[] arguments) throws java.lang.reflect.InvocationTargetException, IllegalAccessException<a name="line.394"></a>
<FONT color="green">395</FONT>        {<a name="line.395"></a>
<FONT color="green">396</FONT>            /** require<a name="line.396"></a>
<FONT color="green">397</FONT>            [valid_collection_param] collection != null;<a name="line.397"></a>
<FONT color="green">398</FONT>            [valid_response_param] response != null;<a name="line.398"></a>
<FONT color="green">399</FONT>            [valid_toSelector_param] toSelector != null;<a name="line.399"></a>
<FONT color="green">400</FONT>            [is_collection] isCollection(collection);<a name="line.400"></a>
<FONT color="green">401</FONT>            [collection_items_respond_to_selector] collectionContainsInstancesRespondingTo(collection, toSelector); **/<a name="line.401"></a>
<FONT color="green">402</FONT>    <a name="line.402"></a>
<FONT color="green">403</FONT>            NSMutableArray objectsResponding = new NSMutableArray();<a name="line.403"></a>
<FONT color="green">404</FONT>            Enumeration collectionEnumerator = enumerationForCollection(collection);<a name="line.404"></a>
<FONT color="green">405</FONT>            while (collectionEnumerator.hasMoreElements())<a name="line.405"></a>
<FONT color="green">406</FONT>            {<a name="line.406"></a>
<FONT color="green">407</FONT>                try<a name="line.407"></a>
<FONT color="green">408</FONT>                {<a name="line.408"></a>
<FONT color="green">409</FONT>                    Object theElement = collectionEnumerator.nextElement();<a name="line.409"></a>
<FONT color="green">410</FONT>                    Object result = toSelector.invoke(theElement, arguments);<a name="line.410"></a>
<FONT color="green">411</FONT>                    if (result.equals(response))<a name="line.411"></a>
<FONT color="green">412</FONT>                    {<a name="line.412"></a>
<FONT color="green">413</FONT>                        objectsResponding.addObject(theElement);<a name="line.413"></a>
<FONT color="green">414</FONT>                    }<a name="line.414"></a>
<FONT color="green">415</FONT>                }<a name="line.415"></a>
<FONT color="green">416</FONT>                catch (NoSuchMethodException e) { }<a name="line.416"></a>
<FONT color="green">417</FONT>            }<a name="line.417"></a>
<FONT color="green">418</FONT>            return objectsResponding;<a name="line.418"></a>
<FONT color="green">419</FONT>    <a name="line.419"></a>
<FONT color="green">420</FONT>            /** ensure [valid_result] Result != null; **/<a name="line.420"></a>
<FONT color="green">421</FONT>        }<a name="line.421"></a>
<FONT color="green">422</FONT>    <a name="line.422"></a>
<FONT color="green">423</FONT>    <a name="line.423"></a>
<FONT color="green">424</FONT>    <a name="line.424"></a>
<FONT color="green">425</FONT>        /**<a name="line.425"></a>
<FONT color="green">426</FONT>         * Returns an &lt;code&gt;NSArray&lt;/code&gt; with the collection entries passed into the Constructor provided before being set in the array.<a name="line.426"></a>
<FONT color="green">427</FONT>         *<a name="line.427"></a>
<FONT color="green">428</FONT>         * @param collection the collection whose elements we will convert<a name="line.428"></a>
<FONT color="green">429</FONT>         * @param constructor the constructor that will create from &lt;code&gt;String&lt;/code&gt;s the types that should be in the array<a name="line.429"></a>
<FONT color="green">430</FONT>         * @return the array with converted elements<a name="line.430"></a>
<FONT color="green">431</FONT>         */<a name="line.431"></a>
<FONT color="green">432</FONT>        public static NSArray convertCollectionStringElements(Object collection, Constructor constructor) throws InvocationTargetException, IllegalAccessException<a name="line.432"></a>
<FONT color="green">433</FONT>        {<a name="line.433"></a>
<FONT color="green">434</FONT>            /** require<a name="line.434"></a>
<FONT color="green">435</FONT>            [valid_collection_param] collection != null;<a name="line.435"></a>
<FONT color="green">436</FONT>            [valid_constructor_param] constructor != null;<a name="line.436"></a>
<FONT color="green">437</FONT>            [is_collection] isCollection(collection); **/<a name="line.437"></a>
<FONT color="green">438</FONT>            JassAdditions.pre("Collection", "convertCollectionElements", constructor.getParameterTypes().length == 1);<a name="line.438"></a>
<FONT color="green">439</FONT>            JassAdditions.pre("Collection", "convertCollectionElements", constructor.getParameterTypes()[0].isAssignableFrom(String.class));<a name="line.439"></a>
<FONT color="green">440</FONT>            JassAdditions.pre("Collection", "convertCollectionElements", ! Modifier.isAbstract(constructor.getDeclaringClass().getModifiers()));<a name="line.440"></a>
<FONT color="green">441</FONT>    <a name="line.441"></a>
<FONT color="green">442</FONT>            NSMutableArray resultArray = new NSMutableArray();<a name="line.442"></a>
<FONT color="green">443</FONT>            Enumeration collectionEnumerator = enumerationForCollection(collection);<a name="line.443"></a>
<FONT color="green">444</FONT>            while (collectionEnumerator.hasMoreElements())<a name="line.444"></a>
<FONT color="green">445</FONT>            {<a name="line.445"></a>
<FONT color="green">446</FONT>                Object oldElement = (String)collectionEnumerator.nextElement();<a name="line.446"></a>
<FONT color="green">447</FONT>                Object newElement = null;<a name="line.447"></a>
<FONT color="green">448</FONT>                try<a name="line.448"></a>
<FONT color="green">449</FONT>                {<a name="line.449"></a>
<FONT color="green">450</FONT>                    newElement = constructor.newInstance(new Object[] {oldElement});<a name="line.450"></a>
<FONT color="green">451</FONT>                }<a name="line.451"></a>
<FONT color="green">452</FONT>                // Never happens<a name="line.452"></a>
<FONT color="green">453</FONT>                catch (IllegalArgumentException e) {}<a name="line.453"></a>
<FONT color="green">454</FONT>                catch (InstantiationException e) {}<a name="line.454"></a>
<FONT color="green">455</FONT>    <a name="line.455"></a>
<FONT color="green">456</FONT>                resultArray.addObject(newElement);<a name="line.456"></a>
<FONT color="green">457</FONT>            }<a name="line.457"></a>
<FONT color="green">458</FONT>    <a name="line.458"></a>
<FONT color="green">459</FONT>            return resultArray;<a name="line.459"></a>
<FONT color="green">460</FONT>    <a name="line.460"></a>
<FONT color="green">461</FONT>            /** ensure [valid_result] Result != null; **/<a name="line.461"></a>
<FONT color="green">462</FONT>        }<a name="line.462"></a>
<FONT color="green">463</FONT>    <a name="line.463"></a>
<FONT color="green">464</FONT>    <a name="line.464"></a>
<FONT color="green">465</FONT>    <a name="line.465"></a>
<FONT color="green">466</FONT>        /**<a name="line.466"></a>
<FONT color="green">467</FONT>         * Returns an &lt;code&gt;NSArray&lt;/code&gt; whose objects are randomly selected from &lt;code&gt;collection&lt;/code&gt; that are not in &lt;code&gt;notInCollection&lt;/code&gt;.  It will select &lt;em&gt;up to&lt;/em&gt; &lt;code&gt;numberToSelect&lt;/code&gt; objects (if there are enough objects remaining in the collection after removing &lt;code&gt;notInCollection&lt;/code&gt;).  An ordered collection will remain in the same order.<a name="line.467"></a>
<FONT color="green">468</FONT>         *<a name="line.468"></a>
<FONT color="green">469</FONT>         * @param collection the collection to select objects from<a name="line.469"></a>
<FONT color="green">470</FONT>         * @param notInCollection a collection of objects not to select from &lt;code&gt;collection&lt;/code&gt;<a name="line.470"></a>
<FONT color="green">471</FONT>         * @param numberToSelect the number of objects to randomly select<a name="line.471"></a>
<FONT color="green">472</FONT>         * @return the randomly selected objects<a name="line.472"></a>
<FONT color="green">473</FONT>         */<a name="line.473"></a>
<FONT color="green">474</FONT>        public static NSArray randomObjects(Object collection,<a name="line.474"></a>
<FONT color="green">475</FONT>                                            Object notInCollection,<a name="line.475"></a>
<FONT color="green">476</FONT>                                            int numberToSelect)<a name="line.476"></a>
<FONT color="green">477</FONT>        {<a name="line.477"></a>
<FONT color="green">478</FONT>            /** require<a name="line.478"></a>
<FONT color="green">479</FONT>            [valid_collection_param] collection != null;<a name="line.479"></a>
<FONT color="green">480</FONT>            [valid_notInCollection_param] notInCollection != null;<a name="line.480"></a>
<FONT color="green">481</FONT>            [valid_numberToSelect_param] numberToSelect &gt; 0;<a name="line.481"></a>
<FONT color="green">482</FONT>            [collection_is_collection] isCollection(collection);<a name="line.482"></a>
<FONT color="green">483</FONT>            [notInCollection_is_collection] isCollection(notInCollection); **/<a name="line.483"></a>
<FONT color="green">484</FONT>    <a name="line.484"></a>
<FONT color="green">485</FONT>            NSMutableArray randomObjects = collectionToNSMutableArray(collection);<a name="line.485"></a>
<FONT color="green">486</FONT>            randomObjects.removeObjectsInArray(collectionToNSMutableArray(notInCollection));<a name="line.486"></a>
<FONT color="green">487</FONT>            Random random = new Random();<a name="line.487"></a>
<FONT color="green">488</FONT>    <a name="line.488"></a>
<FONT color="green">489</FONT>            while (randomObjects.count() &gt; numberToSelect)<a name="line.489"></a>
<FONT color="green">490</FONT>            {<a name="line.490"></a>
<FONT color="green">491</FONT>                randomObjects.removeObjectAtIndex((int)Math.abs(random.nextInt()) % randomObjects.count());<a name="line.491"></a>
<FONT color="green">492</FONT>            }<a name="line.492"></a>
<FONT color="green">493</FONT>            return randomObjects;<a name="line.493"></a>
<FONT color="green">494</FONT>    <a name="line.494"></a>
<FONT color="green">495</FONT>            /** ensure [valid_result] Result != null; **/<a name="line.495"></a>
<FONT color="green">496</FONT>        }<a name="line.496"></a>
<FONT color="green">497</FONT>    <a name="line.497"></a>
<FONT color="green">498</FONT>    <a name="line.498"></a>
<FONT color="green">499</FONT>    <a name="line.499"></a>
<FONT color="green">500</FONT>        /**<a name="line.500"></a>
<FONT color="green">501</FONT>         * Returns an &lt;code&gt;NSArray&lt;/code&gt; whose objects are randomly selected from &lt;code&gt;collection&lt;/code&gt;.  It will select &lt;em&gt;up to&lt;/em&gt; &lt;code&gt;numberToSelect&lt;/code&gt; objects (if there are enough objects).  An ordered collection will remain in the same order.<a name="line.501"></a>
<FONT color="green">502</FONT>         *<a name="line.502"></a>
<FONT color="green">503</FONT>         * @param collection the collection to select objects from<a name="line.503"></a>
<FONT color="green">504</FONT>         * @param numberToSelect the number of objects to randomly select<a name="line.504"></a>
<FONT color="green">505</FONT>         * @return the randomly selected objects<a name="line.505"></a>
<FONT color="green">506</FONT>         */<a name="line.506"></a>
<FONT color="green">507</FONT>        public static NSArray randomObjects(Object collection,<a name="line.507"></a>
<FONT color="green">508</FONT>                                            int numberToSelect)<a name="line.508"></a>
<FONT color="green">509</FONT>        {<a name="line.509"></a>
<FONT color="green">510</FONT>            /** require<a name="line.510"></a>
<FONT color="green">511</FONT>            [valid_collection_param] collection != null;<a name="line.511"></a>
<FONT color="green">512</FONT>            [valid_numberToSelect_param] numberToSelect &gt; 0;<a name="line.512"></a>
<FONT color="green">513</FONT>            [collection_is_collection] isCollection(collection); **/<a name="line.513"></a>
<FONT color="green">514</FONT>    <a name="line.514"></a>
<FONT color="green">515</FONT>            return randomObjects(collection, new NSArray(), numberToSelect);<a name="line.515"></a>
<FONT color="green">516</FONT>    <a name="line.516"></a>
<FONT color="green">517</FONT>            /** ensure [valid_result] Result != null; **/<a name="line.517"></a>
<FONT color="green">518</FONT>        }<a name="line.518"></a>
<FONT color="green">519</FONT>    <a name="line.519"></a>
<FONT color="green">520</FONT>    <a name="line.520"></a>
<FONT color="green">521</FONT>    <a name="line.521"></a>
<FONT color="green">522</FONT>        /**<a name="line.522"></a>
<FONT color="green">523</FONT>         * Returns an &lt;code&gt;NSArray&lt;/code&gt; whose objects are the first &lt;code&gt;numberToSelect&lt;/code&gt; objects in &lt;code&gt;collection&lt;/code&gt; that are not also in &lt;code&gt;notInCollection&lt;/code&gt;.  It will select &lt;em&gt;up to&lt;/em&gt; &lt;code&gt;numberToSelect&lt;/code&gt; objects (if there are enough objects remaining in the collection after removing &lt;code&gt;notInCollection&lt;/code&gt;).  An ordered collection will remain in the same order.<a name="line.523"></a>
<FONT color="green">524</FONT>         *<a name="line.524"></a>
<FONT color="green">525</FONT>         * @param collection the collection to select objects from<a name="line.525"></a>
<FONT color="green">526</FONT>         * @param notInCollection a collection of objects not to select from &lt;code&gt;collection&lt;/code&gt;<a name="line.526"></a>
<FONT color="green">527</FONT>         * @param numberToSelect the number of objects to select<a name="line.527"></a>
<FONT color="green">528</FONT>         * @return the selected objects<a name="line.528"></a>
<FONT color="green">529</FONT>         */<a name="line.529"></a>
<FONT color="green">530</FONT>        public static NSArray firstObjects(Object collection,<a name="line.530"></a>
<FONT color="green">531</FONT>                                           Object notInCollection,<a name="line.531"></a>
<FONT color="green">532</FONT>                                           int numberToSelect)<a name="line.532"></a>
<FONT color="green">533</FONT>        {<a name="line.533"></a>
<FONT color="green">534</FONT>            /** require<a name="line.534"></a>
<FONT color="green">535</FONT>            [valid_collection_param] collection != null;<a name="line.535"></a>
<FONT color="green">536</FONT>            [valid_notInCollection_param] notInCollection != null;<a name="line.536"></a>
<FONT color="green">537</FONT>            [valid_numberToSelect_param] numberToSelect &gt; 0;<a name="line.537"></a>
<FONT color="green">538</FONT>            [collection_is_collection] isCollection(collection);<a name="line.538"></a>
<FONT color="green">539</FONT>            [notInCollection_is_collection] isCollection(notInCollection); **/<a name="line.539"></a>
<FONT color="green">540</FONT>    <a name="line.540"></a>
<FONT color="green">541</FONT>            NSMutableArray firstObjects = collectionToNSMutableArray(collection);<a name="line.541"></a>
<FONT color="green">542</FONT>            firstObjects.removeObjectsInArray(collectionToNSMutableArray(notInCollection));<a name="line.542"></a>
<FONT color="green">543</FONT>    <a name="line.543"></a>
<FONT color="green">544</FONT>            NSRange objectRange = new NSRange(0, (int)Math.min(numberToSelect, firstObjects.count()));<a name="line.544"></a>
<FONT color="green">545</FONT>            return firstObjects.subarrayWithRange(objectRange);<a name="line.545"></a>
<FONT color="green">546</FONT>    <a name="line.546"></a>
<FONT color="green">547</FONT>            /** ensure [valid_result] Result != null; **/<a name="line.547"></a>
<FONT color="green">548</FONT>        }<a name="line.548"></a>
<FONT color="green">549</FONT>    <a name="line.549"></a>
<FONT color="green">550</FONT>    <a name="line.550"></a>
<FONT color="green">551</FONT>    <a name="line.551"></a>
<FONT color="green">552</FONT>        /**<a name="line.552"></a>
<FONT color="green">553</FONT>         * Returns an &lt;code&gt;NSArray&lt;/code&gt; whose objects are the first &lt;code&gt;numberToSelect&lt;/code&gt; objects in &lt;code&gt;collection&lt;/code&gt;.  It will select &lt;em&gt;up to&lt;/em&gt; &lt;code&gt;numberToSelect&lt;/code&gt; objects (if there are enough objects).  An ordered collection will remain in the same order.<a name="line.553"></a>
<FONT color="green">554</FONT>         *<a name="line.554"></a>
<FONT color="green">555</FONT>         * @param collection the collection to select objects from<a name="line.555"></a>
<FONT color="green">556</FONT>         * @param numberToSelect the number of objects to select<a name="line.556"></a>
<FONT color="green">557</FONT>         * @return the selected objects<a name="line.557"></a>
<FONT color="green">558</FONT>         */<a name="line.558"></a>
<FONT color="green">559</FONT>        public static NSArray firstObjects(Object collection,<a name="line.559"></a>
<FONT color="green">560</FONT>                                           int numberToSelect)<a name="line.560"></a>
<FONT color="green">561</FONT>        {<a name="line.561"></a>
<FONT color="green">562</FONT>            /** require<a name="line.562"></a>
<FONT color="green">563</FONT>            [valid_collection_param] collection != null;<a name="line.563"></a>
<FONT color="green">564</FONT>            [valid_numberToSelect_param] numberToSelect &gt; 0;<a name="line.564"></a>
<FONT color="green">565</FONT>            [collection_is_collection] isCollection(collection); **/<a name="line.565"></a>
<FONT color="green">566</FONT>    <a name="line.566"></a>
<FONT color="green">567</FONT>            return firstObjects(collection, new NSArray(), numberToSelect);<a name="line.567"></a>
<FONT color="green">568</FONT>    <a name="line.568"></a>
<FONT color="green">569</FONT>            /** ensure [valid_result] Result != null; **/<a name="line.569"></a>
<FONT color="green">570</FONT>        }<a name="line.570"></a>
<FONT color="green">571</FONT>    <a name="line.571"></a>
<FONT color="green">572</FONT>    <a name="line.572"></a>
<FONT color="green">573</FONT>    <a name="line.573"></a>
<FONT color="green">574</FONT>        /**<a name="line.574"></a>
<FONT color="green">575</FONT>         * Removes objects in &lt;code&gt;notInCollection&lt;/code&gt; from and then divides &lt;code&gt;collection&lt;/code&gt; into sub-arrays, each with at most &lt;code&gt;numberPerSubarray&lt;/code&gt; objects (the last subarray may contain less if not evenly divisible by the number of objects in the collection), and returns an array containing those subarrays.  An ordered collection will remain in the same order.<a name="line.575"></a>
<FONT color="green">576</FONT>         *<a name="line.576"></a>
<FONT color="green">577</FONT>         * @param collection the collection to select objects from<a name="line.577"></a>
<FONT color="green">578</FONT>         * @param notInCollection a collection of objects not to select from &lt;code&gt;collection&lt;/code&gt;<a name="line.578"></a>
<FONT color="green">579</FONT>         * @param numberPerSubarray the number of objects to select<a name="line.579"></a>
<FONT color="green">580</FONT>         * @return the selected objects<a name="line.580"></a>
<FONT color="green">581</FONT>         */<a name="line.581"></a>
<FONT color="green">582</FONT>        public static NSArray divideObjects(Object collection,<a name="line.582"></a>
<FONT color="green">583</FONT>                                            Object notInCollection,<a name="line.583"></a>
<FONT color="green">584</FONT>                                            int numberPerSubarray)<a name="line.584"></a>
<FONT color="green">585</FONT>        {<a name="line.585"></a>
<FONT color="green">586</FONT>            /** require<a name="line.586"></a>
<FONT color="green">587</FONT>            [valid_collection_param] collection != null;<a name="line.587"></a>
<FONT color="green">588</FONT>            [valid_notInCollection_param] notInCollection != null;<a name="line.588"></a>
<FONT color="green">589</FONT>            [valid_numberPerSubarray_param] numberPerSubarray &gt; 0;<a name="line.589"></a>
<FONT color="green">590</FONT>            [collection_is_collection] isCollection(collection);<a name="line.590"></a>
<FONT color="green">591</FONT>            [notInCollection_is_collection] isCollection(notInCollection); **/<a name="line.591"></a>
<FONT color="green">592</FONT>    <a name="line.592"></a>
<FONT color="green">593</FONT>            NSMutableArray divideObjects = new NSMutableArray();<a name="line.593"></a>
<FONT color="green">594</FONT>            NSMutableArray objectsForDivision = collectionToNSMutableArray(collection);<a name="line.594"></a>
<FONT color="green">595</FONT>            objectsForDivision.removeObjectsInArray(collectionToNSMutableArray(notInCollection));<a name="line.595"></a>
<FONT color="green">596</FONT>    <a name="line.596"></a>
<FONT color="green">597</FONT>            int numberOfSubarrays = (int)Math.ceil(((double)objectsForDivision.count()) / ((double)numberPerSubarray));<a name="line.597"></a>
<FONT color="green">598</FONT>            for (int i = 0; i &lt; numberOfSubarrays; i++)<a name="line.598"></a>
<FONT color="green">599</FONT>            {<a name="line.599"></a>
<FONT color="green">600</FONT>                int lengthOfSubarray;<a name="line.600"></a>
<FONT color="green">601</FONT>                if (i == numberOfSubarrays - 1)<a name="line.601"></a>
<FONT color="green">602</FONT>                {<a name="line.602"></a>
<FONT color="green">603</FONT>                    // The last time around is special...<a name="line.603"></a>
<FONT color="green">604</FONT>                    lengthOfSubarray = objectsForDivision.count() % numberPerSubarray;<a name="line.604"></a>
<FONT color="green">605</FONT>                }<a name="line.605"></a>
<FONT color="green">606</FONT>                else<a name="line.606"></a>
<FONT color="green">607</FONT>                {<a name="line.607"></a>
<FONT color="green">608</FONT>                    lengthOfSubarray = numberPerSubarray;<a name="line.608"></a>
<FONT color="green">609</FONT>                }<a name="line.609"></a>
<FONT color="green">610</FONT>                NSRange rangeOfSubarray = new NSRange(i * numberPerSubarray, lengthOfSubarray);<a name="line.610"></a>
<FONT color="green">611</FONT>                divideObjects.addObject(objectsForDivision.subarrayWithRange(rangeOfSubarray));<a name="line.611"></a>
<FONT color="green">612</FONT>            }<a name="line.612"></a>
<FONT color="green">613</FONT>    <a name="line.613"></a>
<FONT color="green">614</FONT>            return divideObjects;<a name="line.614"></a>
<FONT color="green">615</FONT>    <a name="line.615"></a>
<FONT color="green">616</FONT>            /** ensure [valid_result] Result != null; **/<a name="line.616"></a>
<FONT color="green">617</FONT>        }<a name="line.617"></a>
<FONT color="green">618</FONT>    <a name="line.618"></a>
<FONT color="green">619</FONT>    <a name="line.619"></a>
<FONT color="green">620</FONT>    <a name="line.620"></a>
<FONT color="green">621</FONT>        /**<a name="line.621"></a>
<FONT color="green">622</FONT>        * Divides &lt;code&gt;collection&lt;/code&gt; into sub-arrays, each with at most &lt;code&gt;numberPerSubarray&lt;/code&gt; objects (the last subarray may contain less if not evenly divisible by the number of objects in the collection), and returns an array containing those subarrays.  An ordered collection will remain in the same order.<a name="line.622"></a>
<FONT color="green">623</FONT>         *<a name="line.623"></a>
<FONT color="green">624</FONT>         * @param collection the collection to select objects from<a name="line.624"></a>
<FONT color="green">625</FONT>         * @param numberPerSubarray the number of objects to select<a name="line.625"></a>
<FONT color="green">626</FONT>         * @return the selected objects<a name="line.626"></a>
<FONT color="green">627</FONT>         */<a name="line.627"></a>
<FONT color="green">628</FONT>        public static NSArray divideObjects(Object collection,<a name="line.628"></a>
<FONT color="green">629</FONT>                                            int numberPerSubarray)<a name="line.629"></a>
<FONT color="green">630</FONT>        {<a name="line.630"></a>
<FONT color="green">631</FONT>            /** require<a name="line.631"></a>
<FONT color="green">632</FONT>            [valid_collection_param] collection != null;<a name="line.632"></a>
<FONT color="green">633</FONT>            [valid_numberPerSubarray_param] numberPerSubarray &gt; 0;<a name="line.633"></a>
<FONT color="green">634</FONT>            [collection_is_collection] isCollection(collection); **/<a name="line.634"></a>
<FONT color="green">635</FONT>    <a name="line.635"></a>
<FONT color="green">636</FONT>            return divideObjects(collection, new NSArray(), numberPerSubarray);<a name="line.636"></a>
<FONT color="green">637</FONT>    <a name="line.637"></a>
<FONT color="green">638</FONT>            /** ensure [valid_result] Result != null; **/<a name="line.638"></a>
<FONT color="green">639</FONT>        }<a name="line.639"></a>
<FONT color="green">640</FONT>    <a name="line.640"></a>
<FONT color="green">641</FONT>    <a name="line.641"></a>
<FONT color="green">642</FONT>    <a name="line.642"></a>
<FONT color="green">643</FONT>        /**<a name="line.643"></a>
<FONT color="green">644</FONT>         * Given a collection of subcollections, returns an &lt;code&gt;NSArray&lt;/code&gt; containing all the objects in each of the subcollections.  Duplicate objects are removed if &lt;code&gt;removeDuplicates&lt;/code&gt; is &lt;code&gt;true&lt;/code&gt;.  Non-collection sub-entries are added correctly without complaint and sub-sub-collections are added without collapsing.<a name="line.644"></a>
<FONT color="green">645</FONT>         *<a name="line.645"></a>
<FONT color="green">646</FONT>         * @param collection the collection to collapse<a name="line.646"></a>
<FONT color="green">647</FONT>         * @param removeDuplicates &lt;code&gt;true&lt;/code&gt; if this should remove duplicate objects from the array before returning<a name="line.647"></a>
<FONT color="green">648</FONT>         * @return an array containing objects from the collection of arrays<a name="line.648"></a>
<FONT color="green">649</FONT>         */<a name="line.649"></a>
<FONT color="green">650</FONT>        public static NSArray arrayByCollapsingSubCollections(Object collection,<a name="line.650"></a>
<FONT color="green">651</FONT>                                                              boolean removeDuplicates)<a name="line.651"></a>
<FONT color="green">652</FONT>        {<a name="line.652"></a>
<FONT color="green">653</FONT>            NSMutableArray arrayByCollapsingSubCollections = new NSMutableArray();<a name="line.653"></a>
<FONT color="green">654</FONT>            Enumeration collectionEnumeration = enumerationForCollection(collection);<a name="line.654"></a>
<FONT color="green">655</FONT>            while (collectionEnumeration.hasMoreElements())<a name="line.655"></a>
<FONT color="green">656</FONT>            {<a name="line.656"></a>
<FONT color="green">657</FONT>                Object subCollection = collectionEnumeration.nextElement();<a name="line.657"></a>
<FONT color="green">658</FONT>                if ( ! Collection.isCollection(subCollection))<a name="line.658"></a>
<FONT color="green">659</FONT>                {<a name="line.659"></a>
<FONT color="green">660</FONT>                    if (((removeDuplicates) &amp;&amp;<a name="line.660"></a>
<FONT color="green">661</FONT>                         ( ! arrayByCollapsingSubCollections.containsObject(subCollection))) ||<a name="line.661"></a>
<FONT color="green">662</FONT>                        ( ! removeDuplicates))<a name="line.662"></a>
<FONT color="green">663</FONT>                    {<a name="line.663"></a>
<FONT color="green">664</FONT>                        arrayByCollapsingSubCollections.addObject(subCollection);<a name="line.664"></a>
<FONT color="green">665</FONT>                    }<a name="line.665"></a>
<FONT color="green">666</FONT>                }<a name="line.666"></a>
<FONT color="green">667</FONT>                else<a name="line.667"></a>
<FONT color="green">668</FONT>                {<a name="line.668"></a>
<FONT color="green">669</FONT>                    Enumeration subCollectionEnumeration = enumerationForCollection(subCollection);<a name="line.669"></a>
<FONT color="green">670</FONT>                    while (subCollectionEnumeration.hasMoreElements())<a name="line.670"></a>
<FONT color="green">671</FONT>                    {<a name="line.671"></a>
<FONT color="green">672</FONT>                        Object subObject = subCollectionEnumeration.nextElement();<a name="line.672"></a>
<FONT color="green">673</FONT>                        if (((removeDuplicates) &amp;&amp;<a name="line.673"></a>
<FONT color="green">674</FONT>                             ( ! arrayByCollapsingSubCollections.containsObject(subObject))) ||<a name="line.674"></a>
<FONT color="green">675</FONT>                            ( ! removeDuplicates))<a name="line.675"></a>
<FONT color="green">676</FONT>                        {<a name="line.676"></a>
<FONT color="green">677</FONT>                            arrayByCollapsingSubCollections.addObject(subObject);<a name="line.677"></a>
<FONT color="green">678</FONT>                        }<a name="line.678"></a>
<FONT color="green">679</FONT>                    }<a name="line.679"></a>
<FONT color="green">680</FONT>                }<a name="line.680"></a>
<FONT color="green">681</FONT>            }<a name="line.681"></a>
<FONT color="green">682</FONT>            return arrayByCollapsingSubCollections;<a name="line.682"></a>
<FONT color="green">683</FONT>    <a name="line.683"></a>
<FONT color="green">684</FONT>            /** ensure [valid_result] Result != null; **/<a name="line.684"></a>
<FONT color="green">685</FONT>        }<a name="line.685"></a>
<FONT color="green">686</FONT>    <a name="line.686"></a>
<FONT color="green">687</FONT>    <a name="line.687"></a>
<FONT color="green">688</FONT>    <a name="line.688"></a>
<FONT color="green">689</FONT>        /**<a name="line.689"></a>
<FONT color="green">690</FONT>         * Returns &lt;code&gt;true&lt;/code if all the objects in &lt;code&gt;otherCollection&lt;/code&gt; are in &lt;code&gt;collection&lt;/code&gt;.<a name="line.690"></a>
<FONT color="green">691</FONT>         *<a name="line.691"></a>
<FONT color="green">692</FONT>         * @param supersetCollection the collection to select objects from<a name="line.692"></a>
<FONT color="green">693</FONT>         * @param subsetCollection a collection of objects to check for in &lt;code&gt;collection&lt;/code&gt;<a name="line.693"></a>
<FONT color="green">694</FONT>         * @return &lt;code&gt;true&lt;/code&gt; iff all elements of &lt;code&gt;otherCollection&lt;/code&gt; exist in &lt;code&gt;collection&lt;/code&gt;, &lt;code&gt;false&lt;/code&gt; otherwise<a name="line.694"></a>
<FONT color="green">695</FONT>         */<a name="line.695"></a>
<FONT color="green">696</FONT>        public static boolean collectionIsSubsetOfCollection(Object supersetCollection,<a name="line.696"></a>
<FONT color="green">697</FONT>                                                             Object subsetCollection)<a name="line.697"></a>
<FONT color="green">698</FONT>        {<a name="line.698"></a>
<FONT color="green">699</FONT>            /** require<a name="line.699"></a>
<FONT color="green">700</FONT>            [valid_supersetCollection_param] supersetCollection != null;<a name="line.700"></a>
<FONT color="green">701</FONT>            [valid_subsetCollection_param] subsetCollection != null;<a name="line.701"></a>
<FONT color="green">702</FONT>            [supersetCollection_is_collection] isCollection(supersetCollection);<a name="line.702"></a>
<FONT color="green">703</FONT>            [subsetCollection_is_collection] isCollection(subsetCollection); **/<a name="line.703"></a>
<FONT color="green">704</FONT>    <a name="line.704"></a>
<FONT color="green">705</FONT>            NSSet supersetCollectionAsSet = collectionToNSMutableSet(supersetCollection);<a name="line.705"></a>
<FONT color="green">706</FONT>            NSSet subsetCollectionAsSet = collectionToNSMutableSet(subsetCollection);<a name="line.706"></a>
<FONT color="green">707</FONT>            return subsetCollectionAsSet.isSubsetOfSet(supersetCollectionAsSet);<a name="line.707"></a>
<FONT color="green">708</FONT>        }<a name="line.708"></a>
<FONT color="green">709</FONT>    <a name="line.709"></a>
<FONT color="green">710</FONT>    <a name="line.710"></a>
<FONT color="green">711</FONT>    <a name="line.711"></a>
<FONT color="green">712</FONT>    }<a name="line.712"></a>




























































</PRE>
</BODY>
</HTML>
